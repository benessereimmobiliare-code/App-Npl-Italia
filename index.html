


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceleratore Immobiliare</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; overflow-x: hidden; }
        html { overflow-x: hidden; }
        
        /* TOP NAV */
        .top-bar { background: white; padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex-wrap: wrap; gap: 15px; }
        .logo { color: #667eea; font-weight: 700; font-size: 16px; }
        .area-btn { padding: 8px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 11px; font-weight: 600; cursor: pointer; text-align: center; line-height: 1.3; background: white; transition: all 0.3s; }
        .area-btn small { font-size: 9px; font-weight: 500; display: block; margin-top: 2px; }
        .area-free { background: #4CAF50; color: white; border-color: #4CAF50; }
        .area-lock { opacity: 0.6; }
        .area-lock:hover { opacity: 1; transform: scale(1.05); }
        
        /* ═══════════════════════════════════════════════ */
        /* NUOVI BADGE STYLED - 4 Livelli */
        /* ═══════════════════════════════════════════════ */
        
        .badge-area {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 115px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .badge-area:hover { transform: translateY(-2px); }
        
        /* FREE - Verde */
        .badge-free {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: 2px solid #2e7d32;
            box-shadow: 0 3px 12px rgba(76, 175, 80, 0.3);
        }
        
        .badge-free .badge-icon { font-size: 1.6em; margin-bottom: 4px; }
        .badge-free .badge-title { color: #fff; font-size: 0.9em; margin-bottom: 2px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        .badge-free .badge-subtitle { color: #E8F5E9; font-size: 0.7em; text-transform: uppercase; letter-spacing: 1px; }
        
        /* PREMIUM - Oro */
        .badge-premium {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            border: 2px solid #B8860B;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
            position: relative;
        }
        
        .badge-premium::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
            50% { transform: scale(1.05); box-shadow: 0 8px 25px rgba(102,126,234,0.6); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .badge-premium .badge-icon { font-size: 1.6em; margin-bottom: 4px; position: relative; z-index: 1; }
        .badge-premium .badge-title { color: #000; font-size: 0.85em; margin-bottom: 2px; text-shadow: 1px 1px 1px rgba(255,255,255,0.4); position: relative; z-index: 1; line-height: 1.2; }
        .badge-premium .badge-subtitle { color: #4A2C0A; font-size: 0.65em; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700; position: relative; z-index: 1; }
        
        /* VIP - Rubino Rosso */
        .badge-vip {
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 50%, #660000 100%);
            border: 2px solid #800020;
            box-shadow: 0 8px 25px rgba(220, 20, 60, 0.5);
            position: relative;
        }
        
        .badge-vip::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 100, 150, 0.25), transparent);
            animation: shine 3.5s infinite;
        }
        
        .badge-vip::after {
            content: '';
            position: absolute;
            inset: 3px;
            border: 1px solid rgba(255, 215, 0, 0.25);
            border-radius: 8px;
            pointer-events: none;
        }
        
        .badge-vip .badge-icon { font-size: 1.6em; margin-bottom: 4px; position: relative; z-index: 1; }
        .badge-vip .badge-title { color: #fff; font-size: 0.8em; margin-bottom: 2px; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); line-height: 1.2; position: relative; z-index: 1; }
        .badge-vip .badge-subtitle { color: #FFD700; font-size: 0.7em; text-transform: uppercase; letter-spacing: 2px; font-weight: 700; text-shadow: 0 0 6px rgba(255,215,0,0.7); position: relative; z-index: 1; }
        
        /* ESPERTI - Blu Zaffiro */
        .badge-esperti {
            background: linear-gradient(135deg, #4169E1 0%, #1E90FF 50%, #0047AB 100%);
            border: 2px solid #191970;
            box-shadow: 0 6px 20px rgba(65, 105, 225, 0.4);
            position: relative;
        }
        
        .badge-esperti::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 3.2s infinite;
        }
        
        .badge-esperti .badge-icon { font-size: 1.6em; margin-bottom: 4px; position: relative; z-index: 1; }
        .badge-esperti .badge-title { color: #fff; font-size: 0.9em; margin-bottom: 2px; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); position: relative; z-index: 1; }
        .badge-esperti .badge-subtitle { color: #E0FFFF; font-size: 0.65em; text-transform: uppercase; letter-spacing: 1.8px; font-weight: 700; position: relative; z-index: 1; }
        
        /* Badge Bloccato */
        .badge-locked {
            opacity: 0.65;
            cursor: not-allowed;
        }
        
        .badge-locked:hover {
            transform: none;
        }
        
        /* ═══════════════════════════════════════════════ */
        .top-btns { display: flex; gap: 8px; flex-wrap: wrap; }
        .top-btn { padding: 8px 16px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .btn-grn { background: #4CAF50; color: white; }
        .btn-org { background: #FF9800; color: white; }
        .btn-red { background: #f44336; color: white; }
        
        /* TOAST INVESTITORI */
        .toast-inv { position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.25); padding: 18px 22px; min-width: 320px; max-width: 400px; z-index: 888; opacity: 0; transform: translateX(450px); transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .toast-inv.show { opacity: 1; transform: translateX(0); }
        .toast-inv.hide-anim { opacity: 0; transform: translateX(450px); }
        .toast-close { position: absolute; top: 8px; right: 8px; background: transparent; border: none; font-size: 20px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 24px; height: 24px; }
        .toast-close:hover { color: #f44336; }
        .toast-head { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .toast-avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; flex-shrink: 0; }
        .toast-info { flex: 1; }
        .toast-nome { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 3px; }
        .toast-prof { font-size: 12px; color: #666; }
        .toast-det { margin-bottom: 12px; }
        .toast-det div { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 13px; color: #555; }
        .toast-det svg { width: 16px; height: 16px; flex-shrink: 0; }
        .toast-budget { font-size: 20px; font-weight: 700; color: #4CAF50; }
        .toast-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-weight: 700; font-size: 14px; cursor: pointer; transition: transform 0.2s; }
        .toast-btn:hover { transform: scale(1.03); }
        
        @media (max-width: 768px) {
            .toast-inv { bottom: 10px; right: 10px; left: 10px; min-width: auto; max-width: none; }
        }
        
        /* HEADER STATS */
        .hero { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 50px 30px; text-align: center; }
        .hero h1 { font-size: 2.2em; margin-bottom: 8px; }
        .hero p { opacity: 0.95; margin-bottom: 35px; }
        .stats { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .stat { background: rgba(255,255,255,0.15); padding: 18px 25px; border-radius: 10px; min-width: 130px; }
        .stat-num { font-size: 28px; font-weight: 700; }
        .stat-lbl { font-size: 12px; opacity: 0.9; margin-top: 4px; }
        
        /* AFFARI PRONTI */
        .affari { background: #1a1f3a; color: white; padding: 45px 30px; }
        .affari-wrap { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1fr 280px; gap: 35px; align-items: center; }
        .affari h2 { font-size: 1.9em; margin-bottom: 18px; }
        .affari p { line-height: 1.6; margin-bottom: 12px; }
        .affari ul { list-style: none; margin: 18px 0; }
        .affari li { padding: 6px 0 6px 22px; position: relative; }
        .affari li:before { content: '✓'; position: absolute; left: 0; color: #4CAF50; font-weight: 700; }
        .btn-big { background: #FFC107; color: #000; padding: 14px 28px; border: none; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; }
        .box-gold { background: rgba(255,255,255,0.1); padding: 18px; border-radius: 10px; text-align: center; }
        
        /* FILTRI */
        .filtri { background: white; padding: 28px 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .filtri h3 { color: #667eea; margin-bottom: 18px; font-size: 1.4em; }
        .filtri-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 15px; }
        .filtri-grid.hide { display: none !important; }
        .filtri-grid select, .filtri-grid input { padding: 11px; border: 2px solid #ddd; border-radius: 7px; width: 100%; }
        .btn-filtri { display: flex; gap: 8px; }
        
        /* TABS RICERCA */
        .search-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0;
        }
        
        .search-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            bottom: -2px;
        }
        
        .search-tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .search-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.08);
        }
        
        /* BLUR per dati oscurati - POTENZIATO */
        .blur-data {
            filter: blur(5px) brightness(1.1);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            cursor: not-allowed;
            color: #888 !important;
            background: linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.03), rgba(0,0,0,0.06));
            padding: 4px 10px;
            border-radius: 4px;
            display: inline-block;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative;
        }
        
        .blur-data::before {
            content: '🔒';
            position: absolute;
            right: -18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            opacity: 0.5;
        }
        
        .blur-data::selection {
            background: transparent;
        }
        
        .blur-data:hover {
            filter: blur(5px) brightness(1.2);
            background: linear-gradient(90deg, rgba(220,20,60,0.1), rgba(220,20,60,0.05), rgba(220,20,60,0.1));
        }
        
        /* CORSI */
        .corsi { padding: 45px 30px; background: #fafafa; }
        .corsi h3 { text-align: center; font-size: 1.7em; margin-bottom: 35px; color: #333; }
        .corsi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1100px; margin: 0 auto; }
        .card { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .card-ico { padding: 35px; text-align: center; font-size: 55px; }
        .card-txt { background: white; padding: 22px; }
        .card-txt h4 { font-size: 1.2em; margin-bottom: 8px; color: #333; }
        .card-txt p { color: #666; margin-bottom: 12px; line-height: 1.4; }
        .btn-gratis { background: #4CAF50; color: white; padding: 9px 18px; border: none; border-radius: 7px; font-weight: 700; cursor: pointer; }
        
        /* TABELLA */
        .tbl-sec { padding: 35px 30px; background: white; }
        .tbl-sec h3 { font-size: 1.7em; margin-bottom: 25px; color: #333; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; min-width: 1000px; }
        thead { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        th { padding: 12px 10px; text-align: left; font-weight: 600; white-space: nowrap; font-size: 11px; }
        td { padding: 10px; border-bottom: 1px solid #e5e5e5; font-size: 12px; }
        tr:hover { background: #f9f9f9; }
        .badge { padding: 5px 10px; border-radius: 5px; font-weight: 700; font-size: 11px; color: white; display: inline-block; }
        .badge-asta { background: #FF9800; }
        .badge-npl { background: #2196F3; }
        .btn-det { background: #FFC107; color: #000; padding: 7px 14px; border: none; border-radius: 7px; font-weight: 700; cursor: pointer; font-size: 11px; white-space: nowrap; }
        
        /* BLUR */
        .blur-wrap { position: relative; margin-top: 18px; }
        .blur-tbl { filter: blur(4px); opacity: 0.25; }
        .blur-over { 
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            transform: none;
            background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95));
            padding: 15px 25px;
            border-radius: 0;
            text-align: center;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            z-index: 9998;
            max-width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        .blur-over h3 { color: white; font-size: 1.2em; margin: 0; }
        .blur-over p { color: rgba(255,255,255,0.9); margin: 0; font-size: 0.95em; }
        .btn-prem { background: #FFD700; color: #333; padding: 10px 25px; border: none; border-radius: 6px; font-size: 14px; font-weight: 700; cursor: pointer; white-space: nowrap; }
        
        /* LOGIN */
        .login-scr { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #667eea, #764ba2); }
        .login-box { background: white; padding: 38px; border-radius: 18px; box-shadow: 0 18px 55px rgba(0,0,0,0.3); max-width: 380px; width: 100%; }
        .login-box h1 { color: #667eea; margin-bottom: 28px; text-align: center; }
        .inp-grp { margin-bottom: 18px; }
        .inp-grp input { width: 100%; padding: 11px; border: 2px solid #ddd; border-radius: 7px; font-size: 15px; }
        .btn-log { width: 100%; padding: 13px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; }
        
        /* ADMIN */
        .admin { background: #fff; padding: 28px 30px; margin: 0 30px 18px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        
        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.65); z-index: 999; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .modal.show { display: flex; }
        .modal-box { background: white; padding: 28px; border-radius: 12px; max-width: 850px; width: 100%; max-height: 80vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 12px; border-bottom: 2px solid #e5e5e5; position: sticky; top: 0; background: white; z-index: 1; }
        .det-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
        .det-item { padding: 11px; background: #f9f9f9; border-radius: 7px; word-break: break-word; }
        .det-item label { display: block; font-size: 10px; color: #666; margin-bottom: 4px; text-transform: uppercase; font-weight: 600; }
        .det-item .val { font-size: 13px; color: #333; font-weight: 500; }
        
        .hide { display: none !important; }
        .load { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .load.show { display: flex; }
        .spin { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 45px; height: 45px; animation: sp 1s linear infinite; }
        @keyframes sp { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutDown {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100px);
                opacity: 0;
            }
        }
        
        /* RESPONSIVE MOBILE */
        @media (max-width: 768px) {
            body { font-size: 14px; }
            .top-bar { padding: 10px 10px; flex-direction: column; align-items: flex-start; }
            .logo { margin-bottom: 10px; font-size: 14px; }
            .area-btn { padding: 8px 10px; font-size: 9px; min-height: 44px; /* touch area */ }
            .area-btn small { font-size: 7px; }
            .top-btns { width: 100%; justify-content: space-between; flex-wrap: wrap; gap: 5px; }
            .top-btn { padding: 8px 12px; font-size: 10px; min-height: 40px; /* touch area */ }
            #badge { font-size: 10px; padding: 6px 10px; }
            
            /* BADGE MOBILE */
            .badge-area {
                min-width: 95px;
                padding: 8px 12px;
            }
            .badge-area .badge-icon { font-size: 1.3em; margin-bottom: 3px; }
            .badge-area .badge-title { font-size: 0.75em; }
            .badge-area .badge-subtitle { font-size: 0.6em; letter-spacing: 1px; }
            
            .hero { padding: 25px 10px; }
            .hero h1 { font-size: 1.4em; }
            .hero p { font-size: 13px; }
            .stats { gap: 12px; padding: 0 10px; }
            .stat { padding: 12px 15px; min-width: 90px; }
            .stat-num { font-size: 20px; }
            .stat-lbl { font-size: 9px; }
            
            .affari { padding: 25px 10px; }
            .affari-wrap { grid-template-columns: 1fr; gap: 20px; }
            
            /* POPUP CORSO MOBILE */
            #popupCorso { 
                bottom: 10px !important; 
                right: 10px !important; 
                left: 10px !important; 
                max-width: none !important;
                padding: 20px !important;
            }
            .affari h2 { font-size: 1.3em; }
            .affari p { font-size: 13px; }
            .btn-big { padding: 12px 20px; font-size: 13px; min-height: 44px; /* touch area */ }
            
            .corsi { padding: 25px 10px; }
            .corsi h3 { font-size: 1.2em; }
            .corsi-grid { grid-template-columns: 1fr; gap: 15px; }
            .btn-gratis { padding: 10px 18px; min-height: 44px; /* touch area */ }
            
            .filtri { padding: 18px 10px; }
            .filtri h3 { font-size: 1.1em; }
            .filtri-grid { grid-template-columns: 1fr; gap: 10px; }
            .filtri-grid select, .filtri-grid input { min-height: 44px; font-size: 16px; /* iOS zoom fix */ }
            
            .tbl-sec { padding: 18px 8px; }
            .tbl-sec h3 { font-size: 1.2em; margin-bottom: 10px; }
            table { font-size: 10px; min-width: 700px; }
            th { padding: 8px 5px; font-size: 9px; }
            td { padding: 8px 5px; font-size: 10px; }
            .btn-det { padding: 6px 10px; font-size: 10px; min-height: 36px; /* touch area */ }
            
            .modal { padding: 10px; }
            .modal-box { padding: 15px; margin: 5px; max-height: 85vh; }
            .modal-head h2 { font-size: 1.1em; }
            .det-grid { grid-template-columns: 1fr; gap: 8px; }
            .det-item { padding: 10px; }
            .btn-red { min-height: 44px; /* touch area */ }
            
            .admin { padding: 15px 10px; margin: 0 10px 10px; }
            #fileInp { min-height: 44px; /* touch area */ }
            
            .login-box { padding: 20px; margin: 10px; }
            .login-box h1 { font-size: 1.2em; }
            .inp-grp input { min-height: 44px; font-size: 16px; /* iOS zoom fix */ }
            .btn-log { min-height: 44px; /* touch area */ }
        }
        
        @media (max-width: 480px) {
            .hero h1 { font-size: 1.1em; }
            .stats { flex-direction: column; gap: 10px; }
            .stat { width: 100%; max-width: 100%; }
            .area-btn { font-size: 8px; padding: 6px 8px; }
            table { font-size: 9px; min-width: 600px; }
            th, td { padding: 6px 4px; }
        }
    </style>


    <div id="load" class="load"><div style="background:white;padding:35px;border-radius:12px;text-align:center;"><div class="spin"></div><p id="loadTxt" style="margin-top:18px;font-weight:600;">Caricamento...</p></div></div>
    
    <div id="toastInv" class="toast-inv"></div>

    <div id="loginScr" class="login-scr">
        <div class="login-box">
            <h1>🚀 Acceleratore Immobiliare</h1>
            <div id="loginAlert"></div>
            <div class="inp-grp"><input type="text" id="user" placeholder="Username"></div>
            <div class="inp-grp"><input type="password" id="pass" placeholder="Password"></div>
            <button class="btn-log" onclick="doLogin()">Accedi</button>
        </div>
    </div>

    <div id="app" class="hide">
        <div class="top-bar">
            <div class="logo">🚀 Acceleratore Immobiliare</div>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <!-- Badge FREE - Attivo -->
                <div class="badge-area badge-free">
                    <div class="badge-icon">✓</div>
                    <div class="badge-title">Area FREE</div>
                    <div class="badge-subtitle">Attivo</div>
                </div>
                
                <!-- Badge PREMIUM - Bloccato -->
                <div class="badge-area badge-premium badge-locked">
                    <div class="badge-icon">👑</div>
                    <div class="badge-title">Area Premium</div>
                    <div class="badge-subtitle">UPGRADE</div>
                </div>
                
                <!-- Badge VIP - Bloccato -->
                <div class="badge-area badge-vip badge-locked">
                    <div class="badge-icon">🔒</div>
                    <div class="badge-title">Progetto 100 Soci</div>
                    <div class="badge-subtitle">VIP</div>
                </div>
                
                <!-- Badge ESPERTI - Bloccato -->
                <div class="badge-area badge-esperti badge-locked">
                    <div class="badge-icon">💎</div>
                    <div class="badge-title">Area Esperti</div>
                    <div class="badge-subtitle">PRO</div>
                </div>
            </div>
            <div class="top-btns">
                <span id="badge" style="padding:8px 16px;background:#f0f0f0;border-radius:18px;font-weight:600;font-size:12px;"></span>
                
                <!-- BOTTONI ADMIN (solo per admin) -->
                <button class="top-btn btn-grn hide" id="btnUp" onclick="toggleAdmin()">Carica File</button>
                <button class="top-btn btn-org hide" id="btnDel" onclick="delDB()">Svuota DB</button>
                
                <!-- BOTTONI NAVIGAZIONE (per tutti gli utenti) -->
                <button class="top-btn" id="btnAffariPronti" onclick="scrollToSection('affari')" style="background:linear-gradient(135deg,#FFD700,#FFA500);color:#000;font-weight:700;display:none;">
                    🏆 Affari Pronti
                </button>
                <button class="top-btn" id="btnMotoreRicerca" onclick="scrollToSection('ricerca')" style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:700;display:none;">
                    🔍 Motore Ricerca Affari
                </button>
                
                <button class="top-btn btn-red" onclick="doLogout()">Esci</button>
            </div>
        </div>

        <div id="adminPan" class="admin hide">
            <h3 style="color:#667eea;margin-bottom:12px;">📊 Upload Unico - Aste / NPL / Investitori</h3>
            <div id="upAlert"></div>
            <div style="background:#f0f8ff;padding:15px;border-radius:8px;margin-bottom:15px;">
                <p style="margin-bottom:10px;font-size:14px;font-weight:600;">📁 Carica qualsiasi file Excel:</p>
                <ul style="margin-left:20px;margin-bottom:12px;font-size:13px;color:#666;">
                    <li><strong>ASTE</strong> → File con nome che contiene "ASTE" o "aste"</li>
                    <li><strong>NPL</strong> → File con nome che contiene "NPL" o "npl"</li>
                    <li><strong>INVESTITORI</strong> → File con colonne: Nome, Cognome, Email, Cellulare, Budget, Professione</li>
                </ul>
                <input type="file" id="fileInp" accept=".xlsx,.xls" onchange="upFile(event)">
                <p style="margin-top:10px;color:#666;font-size:12px;">💡 L'app riconosce automaticamente il tipo di file!</p>
            </div>
            
            <div style="background:#e8f5e9;padding:15px;border-radius:8px;">
                <h4 style="margin-bottom:10px;color:#2e7d32;">🚀 Caricamento Rapido (Solo Test)</h4>
                <button onclick="caricaDatiEsempio()" class="top-btn btn-grn" style="margin-right:10px;">📥 Carica 15 Investitori Esempio</button>
                <p style="font-size:12px;color:#666;margin-top:8px;">Carica automaticamente 15 investitori con €4.26M totale</p>
            </div>
        </div>

        <div id="investitoriPan" class="admin hide">
            <h3 style="color:#667eea;margin-bottom:12px;">💼 Gestione Investitori</h3>
            <div id="invAlert"></div>
            <p style="margin-bottom:15px;color:#666;font-size:13px;">Capitale Totale: <strong style="color:#4CAF50;font-size:18px;">€<span id="capitaleTot">0</span></strong></p>
            
            <div style="margin-bottom:20px;padding:15px;background:#e8f5e9;border-radius:8px;">
                <h4 style="margin-bottom:10px;">🚀 Dati Iniziali (Solo Prima Volta)</h4>
                <button onclick="caricaDatiEsempio()" class="top-btn btn-grn">📥 Carica 15 Investitori Esempio</button>
                <p style="font-size:12px;color:#666;margin-top:8px;">Carica automaticamente 15 investitori con €4.26M totale</p>
            </div>
            
            <div style="margin-bottom:20px;padding:15px;background:#f0f8ff;border-radius:8px;">
                <h4 style="margin-bottom:10px;">📁 Carica Excel Investitori</h4>
                <input type="file" id="fileInvInp" accept=".xlsx,.xls" onchange="upFileInv(event)" style="margin-bottom:10px;">
                <p style="font-size:12px;color:#666;">Carica file Excel con colonne: Nome, Cognome, Email, Cellulare, Budget, Professione</p>
            </div>
            
            <div style="margin-bottom:20px;">
                <h4 style="margin-bottom:10px;">➕ Aggiungi Investitore Manualmente</h4>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-bottom:10px;">
                    <input type="text" id="invNome" placeholder="Nome">
                    <input type="text" id="invCognome" placeholder="Cognome">
                    <input type="email" id="invEmail" placeholder="Email">
                    <input type="tel" id="invCell" placeholder="Cellulare">
                    <input type="number" id="invBudget" placeholder="Budget €">
                    <input type="text" id="invProf" placeholder="Professione">
                </div>
                <button onclick="aggiungiInvestitore()" class="top-btn btn-grn">➕ Aggiungi</button>
            </div>

            <div style="overflow-x:auto;">
                <table style="width:100%;border-collapse:collapse;font-size:12px;">
                    <thead style="background:#f5f5f5;">
                        <tr>
                            <th style="padding:10px;text-align:left;">Nome</th>
                            <th style="padding:10px;text-align:left;">Cognome</th>
                            <th style="padding:10px;text-align:left;">Email</th>
                            <th style="padding:10px;text-align:left;">Cell</th>
                            <th style="padding:10px;text-align:left;">Budget</th>
                            <th style="padding:10px;text-align:left;">Professione</th>
                            <th style="padding:10px;text-align:left;">Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="invTableBody">
                        <tr><td colspan="7" style="text-align:center;padding:20px;">Caricamento...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="hero">
            <h1>🏠 Acceleratore Immobiliare</h1>
            <p>Accelera i tuoi risultati con gli investimenti immobiliari – Da zero a PRO</p>
            <div class="stats">
                <div class="stat"><div class="stat-num" id="sAste">0</div><div class="stat-lbl">📊 Aste Attive</div></div>
                <div class="stat"><div class="stat-num" id="sNPL">0</div><div class="stat-lbl">📋 NPL Disponibili</div></div>
                <div class="stat"><div class="stat-num">247</div><div class="stat-lbl">⭐ Utenti Premium</div></div>
                <div class="stat"><div class="stat-num">38</div><div class="stat-lbl">💼 Esperti Attivi</div></div>
                <div class="stat">
                    <div class="stat-num" id="statCapitale">€0</div>
                    <div class="stat-lbl">💰 Capitale Disponibile</div>
                    <div style="font-size:10px;color:#ccc;margin-top:4px;">per investitori esperti</div>
                </div>
            </div>
        </div>

        <div class="affari">
            <div class="affari-wrap">
                <div>
                    <h2>💼 Affari Pronti</h2>
                    <p><strong>Sei un investitore super impegnato</strong> dalla mattina alla sera ma vuoi sfruttare la capacità degli iscritti all'<strong>Area Esperti</strong> del nostro Acceleratore?</p>
                    <p>Usufruirai a <strong>costo zero</strong> del "<strong>Servizio Selezione Esperti Investitori Immobiliari</strong>" con:</p>
                    <ul>
                        <li>Analisi accurata del titolare esperto</li>
                        <li>Rating verificato</li>
                        <li>Analisi regole di ingaggio</li>
                        <li>Messa in contatto diretto investitore-esperto</li>
                    </ul>
                    <button class="btn-big" onclick="window.open('https://francesco-gentile.it/richiesta-questionario-inv-capitale/','_blank')">📝 COMPILA IL QUESTIONARIO</button>
                    <p style="margin-top:12px;font-size:12px;opacity:0.85;">ℹ️ <strong>IMPORTANTE:</strong> Questo NON è un servizio di investimento, ma esclusivamente un servizio di messa in contatto diretto tra investitori ed esperti del settore immobiliare.</p>
                </div>
                <div class="box-gold">
                    <div style="font-size:55px;margin-bottom:8px;">🤝</div>
                    <div><strong>Investitori 🤝 Esperti</strong></div>
                    <div style="font-size:12px;margin-top:8px;opacity:0.9;">Servizio gratuito di matching</div>
                </div>
            </div>
        </div>

        <div class="corsi">
            <h3>📚 Corsi Gratuiti per Iniziare</h3>
            <div class="corsi-grid">
                <!-- 1. Come funziona App Acceleratore -->
                <div class="card">
                    <div class="card-ico">📱</div>
                    <div class="card-txt">
                        <h4>Come Funziona l'App Acceleratore</h4>
                        <p>Scopri come usare l'app per trovare opportunità immobiliari velocemente.</p>
                        <div style="display:flex;align-items:center;gap:10px;margin-top:12px;">
                            <button class="btn-gratis" onclick="mostraVideoCorso('https://vimeo.com/1125890927/9621bb9e9a', 'Come Funziona l\'App Acceleratore')">GRATIS</button>
                            <span style="background:#4CAF50;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;display:inline-flex;align-items:center;gap:5px;">
                                ⭐ EASY
                            </span>
                        </div>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
                
                <!-- 2. Pre-asta immobiliari -->
                <div class="card">
                    <div class="card-ico">🏛️</div>
                    <div class="card-txt">
                        <h4>Come Funziona il Settore delle Pre-Asta Immobiliari</h4>
                        <p>Scopri le opportunità prima che vadano all'asta.</p>
                        <div style="margin-top:15px;">
                            <p style="font-weight:600;margin-bottom:8px;">📹 Percorso Video Progressivo:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <!-- Video 1: GRATIS SUBITO (senza link ancora) -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 1\n\nLink in arrivo...')">
                                    ✅ VIDEO 1
                                </button>
                                <!-- Video 2: GRATIS SUBITO con link Vimeo -->
                                <button class="btn-gratis" onclick="mostraVideoCorso('https://vimeo.com/1127563873/464e9d0871', 'Pre-Aste Video 2')">
                                    ✅ VIDEO 2
                                </button>
                                <!-- Video 3: 20 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(20, 3)">
                                    🔒 VIDEO 3
                                </button>
                                <!-- Video 4: 25 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(25, 4)">
                                    🔒 VIDEO 4
                                </button>
                                <!-- Video 5: 30 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(30, 5)">
                                    🔒 VIDEO 5
                                </button>
                                <!-- Video 6: 35 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(35, 6)">
                                    🔒 VIDEO 6
                                </button>
                                <!-- Video 7: 40 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(40, 7)">
                                    🔒 VIDEO 7
                                </button>
                            </div>
                            <p style="font-size:0.85em;color:#666;margin-bottom:12px;">
                                ⏰ I video si sbloccano progressivamente
                            </p>
                            <div style="background:rgba(255,215,0,0.1);border-left:4px solid #FFD700;padding:10px;border-radius:6px;">
                                <p style="margin:0;font-size:0.9em;font-weight:600;color:#FF8C00;">
                                    ⚡ NON VUOI ASPETTARE? <span style="color:#667eea;cursor:pointer;" onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')">Passa a Premium</span> e sblocca tutti i video SUBITO!
                                </p>
                            </div>
                        </div>
                        <span style="background:#4CAF50;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;margin-top:12px;display:inline-block;">⭐ EASY</span>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
                
                <!-- 3. Saldo e Stralcio -->
                <div class="card">
                    <div class="card-ico">💼</div>
                    <div class="card-txt">
                        <h4>Strategie Iniziali per Acquistare con Sconto con il Saldo e Stralcio Immobiliare</h4>
                        <p>Tecniche pratiche per ottenere sconti importanti.</p>
                        <div style="margin-top:15px;">
                            <p style="font-weight:600;margin-bottom:8px;">📹 Percorso Video Progressivo:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <!-- Video 1: GRATIS SUBITO (senza link ancora) -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 1\n\nLink in arrivo...')">
                                    ✅ VIDEO 1
                                </button>
                                <!-- Video 2: GRATIS SUBITO con link Vimeo -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 2\n\nLink da configurare...')">
                                    ✅ VIDEO 2
                                </button>
                                <!-- Video 3: 20 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(20, 3)">
                                    🔒 VIDEO 3
                                </button>
                                <!-- Video 4: 25 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(25, 4)">
                                    🔒 VIDEO 4
                                </button>
                                <!-- Video 5: 30 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(30, 5)">
                                    🔒 VIDEO 5
                                </button>
                                <!-- Video 6: 35 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(35, 6)">
                                    🔒 VIDEO 6
                                </button>
                                <!-- Video 7: 40 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(40, 7)">
                                    🔒 VIDEO 7
                                </button>
                            </div>
                            <p style="font-size:0.85em;color:#666;margin-bottom:12px;">
                                ⏰ I video si sbloccano progressivamente
                            </p>
                            <div style="background:rgba(255,215,0,0.1);border-left:4px solid #FFD700;padding:10px;border-radius:6px;">
                                <p style="margin:0;font-size:0.9em;font-weight:600;color:#FF8C00;">
                                    ⚡ NON VUOI ASPETTARE? <span style="color:#667eea;cursor:pointer;" onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')">Passa a Premium</span> e sblocca tutti i video SUBITO!
                                </p>
                            </div>
                        </div>
                        <span style="background:#4CAF50;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;margin-top:12px;display:inline-block;">⭐ EASY</span>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════════════════════════════ -->
            <!-- 🔥 BANNER PREMIUM IRRESISTIBILE (dopo primi 3 corsi GRATIS)    -->
            <!-- ═══════════════════════════════════════════════════════════════ -->
            <div style="margin:40px 0;padding:0 15px;">
                <div style="background:linear-gradient(135deg, #FFD700 0%, #FFA500 25%, #667eea 75%, #764ba2 100%);border-radius:20px;padding:3px;box-shadow:0 15px 40px rgba(255,215,0,0.4);animation:pulse 2s infinite;position:relative;overflow:hidden;">
                    <!-- Effetto shine animato -->
                    <div style="position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,0.3),transparent);animation:shine 3s infinite;pointer-events:none;"></div>
                    
                    <div style="background:#fff;border-radius:18px;padding:35px 25px;text-align:center;position:relative;z-index:1;">
                        <!-- Badge Premium con animazione -->
                        <div style="display:inline-flex;margin-bottom:20px;animation:bounce 2s infinite;">
                            <div style="background:linear-gradient(135deg,#FFD700,#FFA500);padding:12px 30px;border-radius:25px;box-shadow:0 8px 20px rgba(255,215,0,0.4);border:2px solid #FFD700;">
                                <span style="font-size:1.5em;margin-right:8px;">👑</span>
                                <span style="color:#000;font-weight:900;font-size:1.2em;text-transform:uppercase;letter-spacing:1px;">PREMIUM</span>
                            </div>
                        </div>
                        
                        <!-- Titolo potente -->
                        <h2 style="font-size:clamp(1.6em, 5vw, 2.2em);font-weight:900;background:linear-gradient(135deg,#FFD700,#FF8C00,#667eea);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:0 0 15px 0;line-height:1.2;">
                            🚀 PASSA A PREMIUM ADESSO
                        </h2>
                        
                        <!-- Sottotitolo accattivante -->
                        <p style="font-size:clamp(1.1em, 3.5vw, 1.4em);font-weight:700;color:#667eea;margin:0 0 25px 0;line-height:1.3;">
                            Sblocca TUTTI i Corsi Advanced Mensili
                        </p>
                        
                        <!-- Lista benefici (2 colonne su desktop, 1 su mobile) -->
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;text-align:left;margin:25px auto;max-width:800px;">
                            <div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(102,126,234,0.1));padding:15px;border-radius:12px;border-left:4px solid #FFD700;">
                                <p style="margin:0;font-weight:700;color:#333;font-size:1em;line-height:1.5;">
                                    ✅ Accedi a <strong style="color:#FFD700;">TUTTE le Posizioni NPL</strong>
                                </p>
                            </div>
                            <div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(102,126,234,0.1));padding:15px;border-radius:12px;border-left:4px solid #FF8C00;">
                                <p style="margin:0;font-weight:700;color:#333;font-size:1em;line-height:1.5;">
                                    ✅ <strong style="color:#FF8C00;">Corsi Advanced</strong> Pre-Asta, NPL, Stralci
                                </p>
                            </div>
                            <div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(102,126,234,0.1));padding:15px;border-radius:12px;border-left:4px solid #667eea;">
                                <p style="margin:0;font-weight:700;color:#333;font-size:1em;line-height:1.5;">
                                    ✅ Diventi <strong style="color:#667eea;">ESPERTO in 12 mesi</strong>
                                </p>
                            </div>
                            <div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(102,126,234,0.1));padding:15px;border-radius:12px;border-left:4px solid #764ba2;">
                                <p style="margin:0;font-weight:700;color:#333;font-size:1em;line-height:1.5;">
                                    ✅ <strong style="color:#764ba2;">Supporto Prioritario</strong> 24/7
                                </p>
                            </div>
                        </div>
                        
                        <!-- Urgenza/scarsità -->
                        <div style="background:linear-gradient(135deg,#ff4444,#cc0000);padding:12px 20px;border-radius:10px;margin:20px auto;max-width:500px;">
                            <p style="margin:0;color:#fff;font-weight:700;font-size:clamp(0.95em, 3vw, 1.1em);">
                                ⚡ <strong>OFFERTA LIMITATA:</strong> Solo 50 Posti Disponibili
                            </p>
                        </div>
                        
                        <!-- CTA irresistibile -->
                        <button onclick="window.open('https://francesco-gentile.it/abbonamento-premium', '_blank')" style="background:linear-gradient(135deg,#FFD700,#FF8C00);color:#000;border:none;padding:20px 50px;border-radius:50px;font-size:clamp(1.2em, 4vw, 1.5em);font-weight:900;cursor:pointer;box-shadow:0 10px 30px rgba(255,215,0,0.5);transition:all 0.3s ease;text-transform:uppercase;letter-spacing:1px;margin-top:10px;width:100%;max-width:500px;" onmouseover="this.style.transform='scale(1.05) translateY(-3px)';this.style.boxShadow='0 15px 40px rgba(255,215,0,0.6)'" onmouseout="this.style.transform='scale(1) translateY(0)';this.style.boxShadow='0 10px 30px rgba(255,215,0,0.5)'">
                            👑 DIVENTA PREMIUM ORA 🚀
                        </button>
                        
                        <!-- Garanzia/rassicurazione -->
                        <p style="margin:15px 0 0 0;color:#999;font-size:clamp(0.85em, 2.5vw, 0.95em);line-height:1.4;">
                            💯 <strong>Garanzia 30 giorni</strong> soddisfatto o rimborsato • Disdici quando vuoi
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Riprendi griglia corsi per ultimi 3 -->
            <div class="corsi-grid">
                
                <!-- 4. NPL persona fisica -->
                <div class="card">
                    <div class="card-ico">👤</div>
                    <div class="card-txt">
                        <h4>Come Acquistare NPL come Persona Fisica</h4>
                        <p>Guida completa per privati che vogliono investire in crediti.</p>
                        <div style="margin-top:15px;">
                            <p style="font-weight:600;margin-bottom:8px;">📹 Percorso Video Progressivo:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <!-- Video 1: GRATIS SUBITO (senza link ancora) -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 1\n\nLink in arrivo...')">
                                    ✅ VIDEO 1
                                </button>
                                <!-- Video 2: GRATIS SUBITO con link Vimeo -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 2\n\nLink da configurare...')">
                                    ✅ VIDEO 2
                                </button>
                                <!-- Video 3: 20 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(20, 3)">
                                    🔒 VIDEO 3
                                </button>
                                <!-- Video 4: 25 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(25, 4)">
                                    🔒 VIDEO 4
                                </button>
                                <!-- Video 5: 30 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(30, 5)">
                                    🔒 VIDEO 5
                                </button>
                                <!-- Video 6: 35 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(35, 6)">
                                    🔒 VIDEO 6
                                </button>
                                <!-- Video 7: 40 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(40, 7)">
                                    🔒 VIDEO 7
                                </button>
                            </div>
                            <p style="font-size:0.85em;color:#666;margin-bottom:12px;">
                                ⏰ I video si sbloccano progressivamente
                            </p>
                            <div style="background:rgba(255,215,0,0.1);border-left:4px solid #FFD700;padding:10px;border-radius:6px;">
                                <p style="margin:0;font-size:0.9em;font-weight:600;color:#FF8C00;">
                                    ⚡ NON VUOI ASPETTARE? <span style="color:#667eea;cursor:pointer;" onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')">Passa a Premium</span> e sblocca tutti i video SUBITO!
                                </p>
                            </div>
                        </div>
                        <span style="background:#FF9800;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;margin-top:12px;display:inline-block;">⭐⭐ MEDIO</span>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
                
                <!-- 5. Selezionare affari crediti -->
                <div class="card">
                    <div class="card-ico">🎯</div>
                    <div class="card-txt">
                        <h4>Come Selezionare Affari di Crediti dalla App Posizioni</h4>
                        <p>Criteri e filtri per trovare le migliori opportunità.</p>
                        <div style="margin-top:15px;">
                            <p style="font-weight:600;margin-bottom:8px;">📹 Percorso Video Progressivo:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <!-- Video 1: GRATIS SUBITO (senza link ancora) -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 1\n\nLink in arrivo...')">
                                    ✅ VIDEO 1
                                </button>
                                <!-- Video 2: GRATIS SUBITO con link Vimeo -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 2\n\nLink da configurare...')">
                                    ✅ VIDEO 2
                                </button>
                                <!-- Video 3: 20 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(20, 3)">
                                    🔒 VIDEO 3
                                </button>
                                <!-- Video 4: 25 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(25, 4)">
                                    🔒 VIDEO 4
                                </button>
                                <!-- Video 5: 30 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(30, 5)">
                                    🔒 VIDEO 5
                                </button>
                                <!-- Video 6: 35 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(35, 6)">
                                    🔒 VIDEO 6
                                </button>
                                <!-- Video 7: 40 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(40, 7)">
                                    🔒 VIDEO 7
                                </button>
                            </div>
                            <p style="font-size:0.85em;color:#666;margin-bottom:12px;">
                                ⏰ I video si sbloccano progressivamente
                            </p>
                            <div style="background:rgba(255,215,0,0.1);border-left:4px solid #FFD700;padding:10px;border-radius:6px;">
                                <p style="margin:0;font-size:0.9em;font-weight:600;color:#FF8C00;">
                                    ⚡ NON VUOI ASPETTARE? <span style="color:#667eea;cursor:pointer;" onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')">Passa a Premium</span> e sblocca tutti i video SUBITO!
                                </p>
                            </div>
                        </div>
                        <span style="background:#FF9800;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;margin-top:12px;display:inline-block;">⭐⭐ MEDIO</span>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
                
                <!-- 6. Metodo sleale -->
                <div class="card">
                    <div class="card-ico">🔥</div>
                    <div class="card-txt">
                        <h4>Il Metodo Più Sleale per Chi Investe con gli Immobili</h4>
                        <p>Strategie avanzate che pochi conoscono.</p>
                        <div style="margin-top:15px;">
                            <p style="font-weight:600;margin-bottom:8px;">📹 Percorso Video Progressivo:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <!-- Video 1: GRATIS SUBITO (senza link ancora) -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 1\n\nLink in arrivo...')">
                                    ✅ VIDEO 1
                                </button>
                                <!-- Video 2: GRATIS SUBITO con link Vimeo -->
                                <button class="btn-gratis" onclick="alert('🎬 VIDEO 2\n\nLink da configurare...')">
                                    ✅ VIDEO 2
                                </button>
                                <!-- Video 3: 20 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(20, 3)">
                                    🔒 VIDEO 3
                                </button>
                                <!-- Video 4: 25 giorni -->
                                <button class="btn-gratis" style="background:#FF9800;" onclick="mostraPopupTimer(25, 4)">
                                    🔒 VIDEO 4
                                </button>
                                <!-- Video 5: 30 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(30, 5)">
                                    🔒 VIDEO 5
                                </button>
                                <!-- Video 6: 35 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(35, 6)">
                                    🔒 VIDEO 6
                                </button>
                                <!-- Video 7: 40 giorni -->
                                <button class="btn-gratis" style="background:#999;" onclick="mostraPopupTimer(40, 7)">
                                    🔒 VIDEO 7
                                </button>
                            </div>
                            <p style="font-size:0.85em;color:#666;margin-bottom:12px;">
                                ⏰ I video si sbloccano progressivamente
                            </p>
                            <div style="background:rgba(255,215,0,0.1);border-left:4px solid #FFD700;padding:10px;border-radius:6px;">
                                <p style="margin:0;font-size:0.9em;font-weight:600;color:#FF8C00;">
                                    ⚡ NON VUOI ASPETTARE? <span style="color:#667eea;cursor:pointer;" onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')">Passa a Premium</span> e sblocca tutti i video SUBITO!
                                </p>
                            </div>
                        </div>
                        <span style="background:#F44336;color:white;padding:4px 12px;border-radius:15px;font-size:0.75em;font-weight:700;margin-top:12px;display:inline-block;">⭐⭐⭐ AVANZATO</span>
                        <p class="mobile-warning" style="margin-top:8px;font-size:0.75em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="filtri">
            <h3>🔍 Ricerca</h3>
            
            <!-- SELECT TIPO (scalabile) -->
            <div style="margin-bottom:18px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:#555;">Tipo di ricerca:</label>
                <select id="fTipoRicerca" onchange="cambiaFiltri()" style="width:100%;max-width:300px;padding:11px;border:2px solid #667eea;border-radius:7px;font-size:15px;font-weight:600;color:#667eea;cursor:pointer;">
                    <option value="">Tutte le categorie</option>
                    <option value="Asta">🔨 Aste</option>
                    <option value="NPL">📋 NPL</option>
                    <option value="Investitori">💰 Investitori di Capitale</option>
                </select>
            </div>
            
            <!-- FILTRI ASTE/NPL -->
            <div id="filtriAsteNPL" class="filtri-grid">
                <select id="fReg" onchange="updCitta()"><option value="">Tutte le regioni</option></select>
                <select id="fCit"><option value="">Tutte le città</option></select>
                <input type="text" id="fSearch" placeholder="Cerca...">
            </div>
            
            <div class="btn-filtri">
                <button class="top-btn btn-grn" onclick="appFilt()">✅ Applica Filtri</button>
                <button class="top-btn btn-red" onclick="clrFilt()">🗑️ Azzera Filtri</button>
            </div>
        </div>

        <div class="tbl-sec">
            <h3 id="tblTitle">🔨 Aste Disponibili</h3>
            <p style="margin-bottom:15px;color:#666;font-size:14px;">
                Totale: <strong id="recordCount">0</strong> risultati
                <span id="mobileScrollHint" style="display:none;margin-left:10px;color:#667eea;font-style:italic;"></span>
            </p>
            <p id="mobileTableWarning" class="mobile-warning" style="margin-bottom:12px;font-size:0.8em;color:#FF9800;font-style:italic;display:none;">⚠️ Per una migliore esperienza si sconsiglia l'utilizzo di uno smartphone. Meglio tablet o PC.</p>
            <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: inset 0 0 10px rgba(0,0,0,0.05);">
                <table id="mainTable">
                    <thead id="tblHead">
                        <tr><th>Tipo</th><th>Regione</th><th>Comune</th><th>Indirizzo</th><th>Prezzo Base Asta</th><th>Data Asta</th><th>Azioni</th></tr>
                    </thead>
                    <tbody id="tblBody"><tr><td colspan="7" style="text-align:center;padding:35px;">Carica dati...</td></tr></tbody>
                </table>
            </div>
        </div>
            
            <div id="blurWrap" class="blur-wrap hide">
                <div class="blur-over">
                    <div style="display:flex;align-items:center;gap:15px;flex:1;">
                        <span style="font-size:2em;">🔒</span>
                        <div>
                            <h3 id="blurTit" style="display:inline;margin-right:10px;">Altri NPL Bloccati</h3>
                            <p style="display:inline;font-size:0.95em;">Sblocca l'accesso completo con Area Premium</p>
                        </div>
                    </div>
                    <button class="btn-prem" onclick="window.location.href='#premium'">👑 PASSA A PREMIUM</button>
                </div>
            </div>
        </div>
    

    <div id="modal" class="modal">
        <div class="modal-box">
            <div class="modal-head">
                <h2>Dettaglio</h2>
                <button class="btn-red" onclick="clsMod()" style="padding:7px 14px;border:none;border-radius:7px;font-weight:600;cursor:pointer;">Chiudi</button>
            </div>
            <div id="detCont" class="det-grid"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        let db, allData = [], usr = null, fbOk = false;
        let currentPage = 1;
        const itemsPerPage = 50;
        let investitori = [];
        let capitaleDisponibile = 0; // parte da 0
        let currentType = 'Tutti'; // Tipo attivo: Tutti, Asta, NPL, Investitori
        
        const usrs = {
            // ADMIN (lvl 3) - Accesso completo + pannello admin
            'admin': {pw: 'admin2025', rol: 'Admin', lvl: 3},
            
            // FREE (lvl 1) - Aste + Prime 5 NPL
            'free': {pw: 'free', rol: 'FREE', lvl: 1}
        };
        
        // Inizializza counter visivo a €0
        window.addEventListener('DOMContentLoaded', () => {
            const statEl = document.getElementById('statCapitale');
            if (statEl) statEl.textContent = '€0';
            
            // ASSICURA che filtri Aste/NPL siano visibili all'inizio
            const filtriAste = document.getElementById('filtriAsteNPL');
            if (filtriAste) filtriAste.classList.remove('hide');
        });

        function shLd(t = 'Caricamento...') { document.getElementById('loadTxt').textContent = t; document.getElementById('load').classList.add('show'); }
        function hdLd() { document.getElementById('load').classList.remove('show'); }

        async function initFB() {
            if (fbOk) return;
            return new Promise((ok, err) => {
                let n = 0;
                function go() {
                    n++;
                    if (typeof firebase === 'undefined') {
                        if (n > 20) { err(new Error('Firebase non caricato')); return; }
                        setTimeout(go, 500);
                        return;
                    }
                    try {
                        if (!firebase.apps.length) {
                            firebase.initializeApp({
                                apiKey: "AIzaSyCrdoY0gxuzPdSp955NhnQBRkjRIUpdPKI",
                                authDomain: "app-npl-italia.firebaseapp.com",
                                databaseURL: "https://app-npl-italia-default-rtdb.europe-west1.firebasedatabase.app",
                                projectId: "app-npl-italia",
                                storageBucket: "app-npl-italia.firebasestorage.app",
                                messagingSenderId: "299298163787",
                                appId: "1:299298163787:web:4d08b7dd3273aa4dc011ce"
                            });
                        }
                        db = firebase.database();
                        fbOk = true;
                        console.log('✅ FB OK');
                        ok();
                    } catch (e) { err(e); }
                }
                go();
            });
        }

        async function doLogin() {
            const u = document.getElementById('user').value.toLowerCase().trim();
            const p = document.getElementById('pass').value;
            if (usrs[u] && usrs[u].pw === p) {
                shLd('Connessione...');
                try {
                    await initFB();
                    usr = {u, rol: usrs[u].rol, lvl: usrs[u].lvl};
                    
                    // NO AUTO-LOGIN - commenta la riga sotto se vuoi auto-login
                    // localStorage.setItem('usr', JSON.stringify(usr));
                    
                    document.getElementById('loginScr').classList.add('hide');
                    document.getElementById('app').classList.remove('hide');
                    document.getElementById('badge').textContent = `${usr.rol}: ${u}`;
                    
                    // Mostra bottoni admin solo per admin (lvl 3)
                    if (usr.lvl === 3) {
                        document.getElementById('btnUp').classList.remove('hide');
                        document.getElementById('btnDel').classList.remove('hide');
                    }
                    
                    // Mostra bottoni navigazione per TUTTI gli utenti
                    document.getElementById('btnAffariPronti').style.display = 'inline-block';
                    document.getElementById('btnMotoreRicerca').style.display = 'inline-block';
                    
                    await ldData();
                    
                    // ═══════════════════════════════════════════════════════
                    // 🎯 AVVIA TIMER POPUP (dopo login)
                    // ═══════════════════════════════════════════════════════
                    console.log('⏰ Timer popup avviati!');
                    
                    // ═══════════════════════════════════════════════════════
                    // 🔇 POPUP AUTOMATICI TEMPORANEAMENTE DISABILITATI
                    // ═══════════════════════════════════════════════════════
                    
                    /* DISABILITATO TEMPORANEAMENTE
                    // POPUP ESPERTO - Dopo 10 SECONDI (10000 ms) ← TEST RAPIDO
                    // Cambia a 300000 (5 minuti) per produzione
                    setTimeout(() => {
                        if (popupManager.canShowPopup()) {
                            console.log('✅ Mostrando Popup Esperto');
                            showPopupEsperto();
                            if (window.popupOverlay) {
                                popupManager.registerPopup(window.popupOverlay);
                            }
                        } else {
                            console.log('⏸️ Popup Esperto bloccato dal popupManager');
                        }
                    }, 10000); // 10 secondi per TEST ← Cambia a 300000 per produzione
                    
                    // POPUP CORSO GRATUITO - Dopo 20 SECONDI (20000 ms) ← TEST RAPIDO
                    // Cambia a 480000 (8 minuti) per produzione
                    setTimeout(() => {
                        if (popupManager.canShowPopup()) {
                            console.log('✅ Mostrando Popup Corso');
                            showPopupCorsoGratuito();
                        } else {
                            console.log('⏸️ Popup Corso bloccato dal popupManager');
                        }
                    }, 20000); // 20 secondi per TEST ← Cambia a 480000 per produzione
                    */
                    
                    console.log('🔇 Popup automatici disabilitati per testing');
                    
                } catch (e) {
                    alert('Errore: ' + e.message);
                } finally {
                    hdLd();
                }
            } else {
                document.getElementById('loginAlert').innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:11px;border-radius:7px;margin-bottom:13px;">❌ Credenziali errate!</div>';
                setTimeout(() => document.getElementById('loginAlert').innerHTML = '', 2500);
            }
        }

        function doLogout() {
            usr = null; allData = [];
            // localStorage.removeItem('usr'); // NON SERVE PIÙ
            document.getElementById('loginScr').classList.remove('hide');
            document.getElementById('app').classList.add('hide');
            document.getElementById('user').value = '';
            document.getElementById('pass').value = '';
            
            // Nasconde bottoni navigazione
            document.getElementById('btnAffariPronti').style.display = 'none';
            document.getElementById('btnMotoreRicerca').style.display = 'none';
        }

        // ═══════════════════════════════════════════════════════
        // 🔍 FUNZIONE SCROLL TO SECTION (bottoni navigazione)
        // ═══════════════════════════════════════════════════════
        function scrollToSection(section) {
            let targetElement;
            
            if (section === 'ricerca') {
                // Scroll alla sezione filtri/tabella
                targetElement = document.querySelector('.filtri') || document.querySelector('.tbl-sec');
            } else if (section === 'affari' || section === 'investitori') {
                // Scroll alla sezione investitori/affari pronti nella dashboard
                targetElement = document.querySelector('.box-gold');
            }
            
            if (targetElement) {
                targetElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        }

        // DISABILITO AUTO-LOGIN
        /*
        window.addEventListener('DOMContentLoaded', async () => {
            const saved = localStorage.getItem('usr');
            if (saved) {
                try {
                    usr = JSON.parse(saved);
                    shLd('Connessione...');
                    await initFB();
                    document.getElementById('loginScr').classList.add('hide');
                    document.getElementById('app').classList.remove('hide');
                    document.getElementById('badge').textContent = `${usr.rol}: ${usr.u}`;
                    if (usr.lvl === 3) {
                        document.getElementById('btnUp').classList.remove('hide');
                        document.getElementById('btnDel').classList.remove('hide');
                    }
                    await ldData();
                    hdLd();
                } catch (e) {
                    localStorage.removeItem('usr');
                    hdLd();
                }
            }
        });
        */

        async function ldData() {
            shLd('Caricamento dati...');
            try {
                const snap = await db.ref('data').once('value');
                const d = snap.val();
                if (!d) {
                    console.log('⚠️ DB vuoto');
                    allData = [];
                    rend();
                    return;
                }
                allData = Array.isArray(d) ? d.filter(x => x) : Object.values(d).filter(x => x);
                console.log(`✅ ${allData.length} record`);
                
                // CARICA INVESTITORI
                await ldInvestitori();
                
                // AVVIA TOAST INVESTITORI
                if (investitori.length > 0) {
                    startToastInvestitori();
                }
                
                popFilt();
                rend();
            } catch (e) {
                console.error('❌', e);
                alert('Errore: ' + e.message);
            } finally {
                hdLd();
            }
        }

        async function ldInvestitori() {
            try {
                console.log('📥 Caricamento investitori da Firebase...');
                const snap = await db.ref('investitori').once('value');
                const d = snap.val();
                console.log('📦 Dati ricevuti:', d);
                
                if (d) {
                    investitori = Array.isArray(d) ? d : Object.values(d);
                    console.log(`✅ ${investitori.length} investitori caricati`);
                    console.log('🔍 Primo investitore:', investitori[0]); // DEBUG
                    
                    // CALCOLA CAPITALE TOTALE (Budget con B maiuscola)
                    capitaleDisponibile = investitori.reduce((sum, inv) => {
                        const budget = inv.Budget || inv.budget || 0;
                        return sum + budget;
                    }, 0);
                    console.log(`💰 Capitale totale: €${capitaleDisponibile.toLocaleString('it-IT')}`);
                    
                    // AGGIORNA COUNTER VISIVO
                    aggiornaCounterCapitale();
                } else {
                    console.log('⚠️ Nessun investitore trovato - database vuoto');
                    investitori = [];
                    capitaleDisponibile = 0;
                    aggiornaCounterCapitale();
                }
            } catch (e) {
                console.error('❌ Errore caricamento investitori:', e);
            }
        }

        function aggiornaCounterCapitale() {
            // Aggiorna stat in alto usando ID
            const statEl = document.getElementById('statCapitale');
            if (statEl) {
                if (capitaleDisponibile >= 1000000) {
                    const milioni = capitaleDisponibile / 1000000;
                    // Se ha decimali significativi, mostra 2 cifre, altrimenti 1
                    const decimali = (milioni % 1 >= 0.05) ? 2 : 1;
                    statEl.textContent = '€' + milioni.toFixed(decimali) + 'M';
                } else if (capitaleDisponibile >= 1000) {
                    statEl.textContent = '€' + (capitaleDisponibile / 1000).toFixed(0) + 'K';
                } else {
                    statEl.textContent = '€' + capitaleDisponibile.toLocaleString('it-IT');
                }
            }
            
            // Aggiorna anche nel pannello investitori se aperto
            const capTotEl = document.getElementById('capitaleTot');
            if (capTotEl) {
                capTotEl.textContent = capitaleDisponibile.toLocaleString('it-IT');
            }
        }

        // POPUP ESPERTO dopo 2 minuti
        let popupShown = false;
        function showPopupEsperto() {
            if (popupShown) return;
            popupShown = true;
            
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;';
            
            const milioni = capitaleDisponibile / 1000000;
            const decimali = (milioni % 1 >= 0.05) ? 2 : 1;
            
            overlay.innerHTML = `
                <div style="background:white;padding:40px;border-radius:20px;max-width:550px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                    <h2 style="color:#667eea;font-size:1.8em;margin-bottom:15px;">💼 Diventa Esperto Investitore Premium</h2>
                    <p style="font-size:1.5em;font-weight:700;color:#4CAF50;margin-bottom:10px;">Budget Disponibile: €${capitaleDisponibile.toLocaleString('it-IT')}</p>
                    <p style="color:#666;margin-bottom:15px;line-height:1.6;">Gli investitori della nostra rete hanno un capitale totale di <strong>€${milioni.toFixed(decimali)}M</strong> disponibile per investimenti immobiliari.</p>
                    <div style="background:#fff3cd;border-left:4px solid #FFC107;padding:15px;margin-bottom:20px;text-align:left;">
                        <p style="color:#856404;font-weight:600;margin-bottom:8px;">⚡ ACCESSO PRIORITARIO</p>
                        <p style="color:#856404;font-size:14px;line-height:1.5;margin:0;">Prima diventi <strong>Esperto Premium</strong>, prima accedi ai <strong>dati completi dei nostri investitori</strong> e alle opportunità esclusive.</p>
                    </div>
                    <div style="display:flex;gap:15px;flex-wrap:wrap;">
                        <button onclick="candidatiEsperto()" style="flex:1;padding:15px 25px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;min-width:180px;">✅ Sono Esperto e Approfitto</button>
                        <button onclick="chiudiPopup()" style="flex:1;padding:15px 25px;background:#f44336;color:white;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;min-width:180px;">❌ Non Sono Esperto</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            window.popupOverlay = overlay;
        }

        function candidatiEsperto() {
            alert('🎉 Ottimo! Ti contatteremo presto per completare la candidatura come Esperto Investitore.');
            chiudiPopup();
        }

        function chiudiPopup() {
            if (window.popupOverlay) {
                window.popupOverlay.remove();
            }
            popupManager.lastPopupTime = Date.now(); // Aggiorna ultimo popup chiuso
        }
        
        // ═══════════════════════════════════════════════════════════
        // 🔒 POPUP PREMIUM - NPL RIGHETTI (Pre-analizzati)
        // ═══════════════════════════════════════════════════════════
        function shPremiumPopup() {
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s;';
            
            overlay.innerHTML = `
                <div style="background:white;padding:45px;border-radius:25px;max-width:600px;width:100%;text-align:center;box-shadow:0 25px 80px rgba(255,215,0,0.5);position:relative;overflow:hidden;">
                    <!-- Sfondo decorativo -->
                    <div style="position:absolute;top:-50px;right:-50px;width:200px;height:200px;background:linear-gradient(135deg,#FFD700,#FFA500);opacity:0.1;border-radius:50%;"></div>
                    <div style="position:absolute;bottom:-30px;left:-30px;width:150px;height:150px;background:linear-gradient(135deg,#667eea,#764ba2);opacity:0.1;border-radius:50%;"></div>
                    
                    <!-- Badge Premium -->
                    <div style="display:inline-flex;margin-bottom:20px;animation:pulse 2s infinite;">
                        <div style="background:linear-gradient(135deg,#FFD700,#FFA500);padding:12px 30px;border-radius:25px;box-shadow:0 8px 20px rgba(255,215,0,0.4);">
                            <span style="font-size:1.5em;margin-right:8px;">👑</span>
                            <span style="color:#000;font-weight:900;font-size:1.2em;text-transform:uppercase;letter-spacing:1px;">PREMIUM</span>
                        </div>
                    </div>
                    
                    <!-- Titolo -->
                    <h2 style="color:#333;font-size:clamp(1.6em, 5vw, 2em);font-weight:900;margin-bottom:15px;line-height:1.2;">
                        🔒 Posizione Pre-Analizzata dal Nostro Staff
                    </h2>
                    
                    <!-- Descrizione -->
                    <p style="color:#666;font-size:clamp(1em, 3vw, 1.15em);margin-bottom:25px;line-height:1.6;">
                        Questa posizione NPL è stata <strong style="color:#FFD700;">accuratamente analizzata</strong> dal nostro team di esperti. 
                        Avrai accesso a:
                    </p>
                    
                    <!-- Lista benefici -->
                    <div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(102,126,234,0.1));padding:20px;border-radius:15px;margin-bottom:25px;text-align:left;">
                        <div style="margin-bottom:12px;">
                            <span style="color:#4CAF50;font-size:1.3em;margin-right:8px;">✅</span>
                            <strong>Analisi completa della posizione</strong>
                        </div>
                        <div style="margin-bottom:12px;">
                            <span style="color:#4CAF50;font-size:1.3em;margin-right:8px;">✅</span>
                            <strong>Valutazione rischi e opportunità</strong>
                        </div>
                        <div style="margin-bottom:12px;">
                            <span style="color:#4CAF50;font-size:1.3em;margin-right:8px;">✅</span>
                            <strong>Dati completi e verificati</strong>
                        </div>
                        <div>
                            <span style="color:#4CAF50;font-size:1.3em;margin-right:8px;">✅</span>
                            <strong>Supporto prioritario del team</strong>
                        </div>
                    </div>
                    
                    <!-- Urgenza -->
                    <div style="background:linear-gradient(135deg,#ff4444,#cc0000);padding:12px 20px;border-radius:10px;margin-bottom:25px;">
                        <p style="margin:0;color:#fff;font-weight:700;font-size:clamp(0.95em, 3vw, 1.1em);">
                            ⚡ <strong>Solo per abbonati PREMIUM</strong>
                        </p>
                    </div>
                    
                    <!-- Bottoni -->
                    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
                        <button onclick="window.open('https://francesco-gentile.it/abbonamento-premium', '_blank')" style="flex:1;min-width:180px;padding:18px 30px;background:linear-gradient(135deg,#FFD700,#FF8C00);color:#000;border:none;border-radius:50px;font-size:clamp(1.1em, 3.5vw, 1.3em);font-weight:900;cursor:pointer;box-shadow:0 10px 30px rgba(255,215,0,0.5);transition:all 0.3s;text-transform:uppercase;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            👑 Diventa Premium
                        </button>
                        <button onclick="chiudiPopupPremium()" style="flex:1;min-width:140px;padding:18px 25px;background:#999;color:#fff;border:none;border-radius:50px;font-size:clamp(1em, 3vw, 1.1em);font-weight:700;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='#777'" onmouseout="this.style.background='#999'">
                            Chiudi
                        </button>
                    </div>
                    
                    <!-- Garanzia -->
                    <p style="margin:20px 0 0 0;color:#999;font-size:clamp(0.85em, 2.5vw, 0.95em);line-height:1.4;">
                        💯 <strong>Garanzia 30 giorni</strong> soddisfatto o rimborsato
                    </p>
                </div>
            `;
            
            document.body.appendChild(overlay);
            window.popupPremiumOverlay = overlay;
        }
        
        function chiudiPopupPremium() {
            if (window.popupPremiumOverlay) {
                window.popupPremiumOverlay.remove();
                window.popupPremiumOverlay = null;
            }
        }

        // ═══════════════════════════════════════════════════════
        // 🎯 SISTEMA GESTIONE POPUP (Anti-sovrapposizione)
        // ═══════════════════════════════════════════════════════
        const popupManager = {
            lastPopupTime: 0, // Inizia a 0 per permettere primo popup dopo 5min
            minDelay: 180000, // 3 minuti tra popup (180000ms)
            activePopup: null,
            
            canShowPopup() {
                const now = Date.now();
                const elapsed = now - this.lastPopupTime;
                const hasActivePopup = this.activePopup && document.body.contains(this.activePopup);
                
                console.log('🔍 Popup check:', {
                    elapsed: Math.floor(elapsed / 1000) + 's',
                    minDelay: Math.floor(this.minDelay / 1000) + 's',
                    hasActivePopup: hasActivePopup,
                    lastPopupTime: this.lastPopupTime
                });
                
                // Se lastPopupTime è 0 (nessun popup ancora mostrato), permetti sempre
                if (this.lastPopupTime === 0) {
                    console.log('✅ Primo popup - sempre permesso');
                    return !hasActivePopup;
                }
                
                // Non mostrare se c'è già un popup attivo o se non sono passati 3 minuti
                if (hasActivePopup || elapsed < this.minDelay) {
                    console.log('❌ Bloccato:', hasActivePopup ? 'popup attivo' : 'troppo presto');
                    return false;
                }
                
                return true;
            },
            
            registerPopup(element) {
                this.activePopup = element;
                this.lastPopupTime = Date.now();
                console.log('✅ Popup registrato:', element.id, 'at', new Date().toLocaleTimeString());
            }
        };

        // I timer popup vengono avviati DOPO il login (vedi funzione doLogin)

        function showPopupCorsoGratuito() {
            if (popupCorsoShown) return;
            popupCorsoShown = true;
            
            const popupCorso = document.createElement('div');
            popupCorso.id = 'popupCorso';
            popupCorso.style.cssText = 'position:fixed;bottom:20px;right:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:25px;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.4);max-width:400px;z-index:9998;animation:slideInUp 0.5s ease-out;';
            
            popupCorso.innerHTML = `
                <button onclick="chiudiPopupCorso()" style="position:absolute;top:10px;right:10px;background:transparent;border:none;color:white;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;line-height:1;">×</button>
                <h3 style="margin:0 0 15px 0;font-size:1.3em;color:#fff;">🎓 Corso GRATUITO per Investitori</h3>
                <p style="margin:0 0 15px 0;font-size:1em;line-height:1.5;">Scopri come <strong>smettere di investire al buio</strong> nei crowdfunding e stringere <strong>partnership dirette</strong> con SRL immobiliari!</p>
                <a href="https://francesco-gentile.it/richiesta-questionario-inv-capitale/" target="_blank" style="display:block;background:#00ff00;color:#000;padding:12px 20px;text-align:center;border-radius:8px;font-weight:700;text-decoration:none;font-size:1.1em;transition:transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    ✅ ACCESSO IMMEDIATO
                </a>
                <p style="margin:10px 0 0 0;font-size:0.85em;opacity:0.9;text-align:center;">Compila il questionario - È gratis!</p>
            `;
            
            document.body.appendChild(popupCorso);
            popupManager.registerPopup(popupCorso); // Registra nel manager
            
            // Auto-chiudi dopo 30 secondi
            setTimeout(() => {
                if (document.getElementById('popupCorso')) {
                    chiudiPopupCorso();
                }
            }, 30000);
        }

        function chiudiPopupCorso() {
            const popup = document.getElementById('popupCorso');
            if (popup) {
                popup.style.animation = 'slideOutDown 0.5s ease-in';
                setTimeout(() => popup.remove(), 500);
                popupManager.lastPopupTime = Date.now(); // Aggiorna tempo
            }
        }

        // ═══════════════════════════════════════════════════════
        // 🎬 POPUP VIDEO CORSO (Vimeo embedded)
        // ═══════════════════════════════════════════════════════
        function mostraVideoCorso(videoUrl, titoloCorso) {
            // Estrai video ID da URL Vimeo
            let videoId = '';
            let hashParam = '';
            
            // Formato: https://vimeo.com/1125890927/9621bb9e9a
            const match = videoUrl.match(/vimeo\.com\/(\d+)\/([a-zA-Z0-9]+)/);
            if (match) {
                videoId = match[1];
                hashParam = match[2];
            }
            
            if (!videoId) {
                alert('URL video non valido');
                return;
            }
            
            // Crea overlay popup
            const overlay = document.createElement('div');
            overlay.id = 'videoPopup';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.3s ease-in;
            `;
            
            // Costruisci URL embed Vimeo con hash
            const embedUrl = `https://player.vimeo.com/video/${videoId}?h=${hashParam}&autoplay=1&title=1&byline=1&portrait=1`;
            
            overlay.innerHTML = `
                <div style="background:white;border-radius:15px;max-width:900px;width:100%;padding:25px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.5);">
                    <button onclick="chiudiVideoCorso()" style="position:absolute;top:10px;right:10px;background:#667eea;color:white;border:none;width:35px;height:35px;border-radius:50%;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold;transition:all 0.2s;" onmouseover="this.style.background='#764ba2'" onmouseout="this.style.background='#667eea'">×</button>
                    
                    <h3 style="color:#667eea;margin:0 0 20px 0;font-size:1.5em;padding-right:40px;">🎬 ${titoloCorso}</h3>
                    
                    <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:10px;background:#000;">
                        <iframe src="${embedUrl}" 
                                style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" 
                                frameborder="0" 
                                allow="autoplay; fullscreen; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    
                    <p style="margin:15px 0 0 0;color:#666;font-size:0.9em;text-align:center;">
                        💡 Premi ESC o clicca X per chiudere
                    </p>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Chiudi con ESC
            document.addEventListener('keydown', function escHandler(e) {
                if (e.key === 'Escape') {
                    chiudiVideoCorso();
                    document.removeEventListener('keydown', escHandler);
                }
            });
            
            // Registra nel popup manager
            popupManager.registerPopup(overlay);
        }

        function chiudiVideoCorso() {
            const popup = document.getElementById('videoPopup');
            if (popup) {
                popup.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => popup.remove(), 300);
                popupManager.lastPopupTime = Date.now();
            }
        }

        // ═══════════════════════════════════════════════════════════════
        // 🎯 SISTEMA TIMER PROGRESSIVO VIDEO
        // ═══════════════════════════════════════════════════════════════
        
        // ⚙️ MODALITÀ TEST: true = minuti, false = giorni
        const MODALITA_TEST = false; // ← PRODUZIONE: Usa GIORNI
        
        function getPrimoAccesso() {
            let dataAccesso = localStorage.getItem('dataAccesso_' + usr.u);
            if (!dataAccesso) {
                // Prima volta: salva data corrente
                dataAccesso = new Date().toISOString();
                localStorage.setItem('dataAccesso_' + usr.u, dataAccesso);
                console.log('✅ Primo accesso registrato:', dataAccesso);
            }
            return new Date(dataAccesso);
        }
        
        function getGiorniTrascorsi() {
            const dataAccesso = getPrimoAccesso();
            const oggi = new Date();
            const diffMs = oggi - dataAccesso;
            
            if (MODALITA_TEST) {
                // 🧪 MODALITÀ TEST: Calcola MINUTI invece di giorni
                const diffMinuti = Math.floor(diffMs / (1000 * 60));
                console.log('🧪 TEST MODE: Minuti trascorsi:', diffMinuti);
                return diffMinuti;
            } else {
                // 🚀 PRODUZIONE: Calcola GIORNI
                const diffGiorni = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                console.log('📅 Giorni trascorsi:', diffGiorni);
                return diffGiorni;
            }
        }
        
        function mostraPopupTimer(giorniRichiesti, numeroVideo) {
            const giorniTrascorsi = getGiorniTrascorsi();
            const giorniMancanti = giorniRichiesti - giorniTrascorsi;
            
            // Testo dinamico: "giorni" o "minuti" in base a modalità
            const unitaTempo = MODALITA_TEST ? 'minuti' : 'giorni';
            const unitaTempoSingolare = MODALITA_TEST ? 'minuto' : 'giorno';
            const unitaTempoMaiuscolo = MODALITA_TEST ? 'MINUTI' : 'GIORNI';
            const unitaTempoMaiuscoloSing = MODALITA_TEST ? 'MINUTO' : 'GIORNO';
            
            console.log(`🎬 Video ${numeroVideo} - Richiesti: ${giorniRichiesti}, Trascorsi: ${giorniTrascorsi}, Mancanti: ${giorniMancanti}`);
            
            // Se utente è Admin, sblocca tutto
            if (usr && usr.lvl === 3) {
                console.log('🔓 ADMIN - Video sbloccato');
                // TODO: Inserire qui il link Vimeo quando disponibile
                alert(`🎬 VIDEO ${numeroVideo}\n\n✅ Come ADMIN puoi vedere questo video.\n\n⚠️ Link video da configurare quando disponibile.`);
                return;
            }
            
            // Se sono passati abbastanza giorni, sblocca il video
            if (giorniTrascorsi >= giorniRichiesti) {
                console.log('🔓 Video sbloccato!');
                // TODO: Inserire qui i veri link Vimeo quando disponibili
                alert(`🎉 CONGRATULAZIONI!\n\nHai sbloccato il Video ${numeroVideo}!\n\n⚠️ Link video da configurare.\n\nQuando avrai i link Vimeo, sostituisci questo alert con:\nmostraVideoCorso('URL_VIMEO', 'Pre-Aste Video ${numeroVideo}')`);
                return;
            }
            
            // Badge TEST se in modalità test
            const badgeTest = MODALITA_TEST ? '<div style="position:fixed;top:10px;left:10px;background:#f44336;color:white;padding:8px 15px;border-radius:20px;font-weight:700;font-size:0.9em;z-index:10002;box-shadow:0 4px 12px rgba(244,67,54,0.4);">🧪 MODALITÀ TEST</div>' : '';
            
            // Altrimenti mostra popup con countdown + invito Premium
            const popup = document.createElement('div');
            popup.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;padding:10px;animation:fadeIn 0.3s;overflow-y:auto;';
            
            popup.innerHTML = badgeTest + `
                <div style="background:white;padding:20px 15px;border-radius:12px;max-width:480px;width:100%;max-height:85vh;overflow-y:auto;text-align:center;position:relative;box-shadow:0 15px 40px rgba(0,0,0,0.4);margin:auto;">
                    <button onclick="this.parentElement.parentElement.remove()" style="position:sticky;top:-5px;right:-5px;float:right;background:#f44336;color:white;border:none;width:36px;height:36px;border-radius:50%;font-size:22px;cursor:pointer;z-index:1;box-shadow:0 3px 10px rgba(0,0,0,0.3);font-weight:700;line-height:32px;">×</button>
                    
                    <!-- Icona Timer -->
                    <div style="font-size:2.5em;margin-bottom:10px;animation:pulse 2s infinite;clear:both;">⏰</div>
                    
                    <!-- Titolo -->
                    <h2 style="color:#FF9800;margin-bottom:10px;font-size:1.3em;line-height:1.3;">Video Bloccato Temporaneamente</h2>
                    
                    <!-- Countdown Box -->
                    <div style="background:linear-gradient(135deg,#FF9800,#F57C00);padding:18px 15px;border-radius:12px;margin-bottom:15px;box-shadow:0 6px 20px rgba(255,152,0,0.3);">
                        <p style="color:white;font-size:0.95em;margin-bottom:8px;font-weight:600;">🎬 Video ${numeroVideo} si sblocca tra:</p>
                        <div style="font-size:2.2em;font-weight:900;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,0.3);line-height:1;">
                            ${giorniMancanti}
                        </div>
                        <p style="color:rgba(255,255,255,0.95);font-size:1em;margin:5px 0 0 0;font-weight:700;">
                            ${giorniMancanti === 1 ? unitaTempoMaiuscoloSing : unitaTempoMaiuscolo}
                        </p>
                    </div>
                    
                    <!-- Progress bar -->
                    <div style="background:#e0e0e0;height:10px;border-radius:8px;margin-bottom:12px;overflow:hidden;">
                        <div style="background:linear-gradient(90deg,#4CAF50,#8BC34A);height:100%;width:${Math.min(100, (giorniTrascorsi/giorniRichiesti)*100)}%;border-radius:8px;transition:width 0.3s;"></div>
                    </div>
                    <p style="color:#666;font-size:0.8em;margin-bottom:15px;line-height:1.4;">
                        Hai completato <strong>${giorniTrascorsi} di ${giorniRichiesti} ${unitaTempo}</strong>
                    </p>
                    
                    <!-- Divider -->
                    <div style="border-top:2px solid #f0f0f0;margin:15px 0;position:relative;">
                        <span style="background:white;padding:0 10px;position:absolute;top:-9px;left:50%;transform:translateX(-50%);color:#999;font-weight:600;font-size:0.85em;">OPPURE</span>
                    </div>
                    
                    <!-- CTA Premium -->
                    <div style="background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,152,0,0.15));border:2px solid #FFD700;padding:12px;border-radius:10px;margin-bottom:12px;">
                        <h3 style="color:#FF8C00;margin:0 0 8px 0;font-size:1.05em;">⚡ NON ASPETTARE!</h3>
                        <p style="color:#666;margin:0 0 10px 0;line-height:1.4;font-size:0.85em;">
                            Passa a <strong style="color:#FFD700;">PREMIUM</strong> e sblocca <strong>TUTTI i video SUBITO</strong>
                        </p>
                        <ul style="text-align:left;margin:0;padding-left:20px;color:#555;line-height:1.5;font-size:0.8em;">
                            <li>✅ Tutti i 7 video Pre-Aste</li>
                            <li>✅ Corsi Advanced</li>
                            <li>✅ NPL senza blur</li>
                            <li>✅ Supporto 24/7</li>
                        </ul>
                    </div>
                    
                    <!-- Bottone Premium -->
                    <button onclick="window.open('https://francesco-gentile.it/abbonamento-premium','_blank')" style="width:100%;padding:13px;background:linear-gradient(135deg,#FFD700,#FFA500);color:#000;border:none;border-radius:25px;font-size:1.05em;font-weight:900;cursor:pointer;box-shadow:0 8px 20px rgba(255,215,0,0.4);transition:all 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        🚀 DIVENTA PREMIUM ORA
                    </button>
                    
                    <!-- Footer -->
                    <p style="margin:10px 0 0 0;color:#999;font-size:0.75em;line-height:1.3;">
                        💯 Garanzia 30 giorni soddisfatto o rimborsato
                    </p>
                </div>
            `;
            
            document.body.appendChild(popup);
        }

        // TOAST INVESTITORI - Rotazione ogni 60 secondi
        let toastIndex = 0;
        let toastInterval = null;
        let currentToast = null;

        function startToastInvestitori() {
            if (investitori.length === 0) return;
            
            // Primo toast dopo 60 secondi
            setTimeout(() => {
                showToastInvestitore();
                
                // Poi ogni 2 minuti (120000 ms)
                toastInterval = setInterval(() => {
                    showToastInvestitore();
                }, 120000);
            }, 60000);
        }

        function showToastInvestitore() {
            if (investitori.length === 0) return;
            
            // Chiudi toast precedente se esiste
            if (currentToast) {
                closeToast();
                setTimeout(() => showToastContent(), 500);
            } else {
                showToastContent();
            }
        }

        function showToastContent() {
            const inv = investitori[toastIndex];
            toastIndex = (toastIndex + 1) % investitori.length;
            
            const nomeParziale = inv.nome + ' ' + (inv.cognome ? inv.cognome.charAt(0) + '.' : '');
            const cellOscurato = oscuraCellulare(inv.cellulare);
            const budgetFormatted = '€' + (inv.budget || 0).toLocaleString('it-IT');
            const iniziali = inv.nome.charAt(0) + (inv.cognome ? inv.cognome.charAt(0) : '');
            
            const toastEl = document.getElementById('toastInv');
            toastEl.innerHTML = `
                <button class="toast-close" onclick="closeToast()">×</button>
                <div class="toast-head">
                    <div class="toast-avatar">${iniziali}</div>
                    <div class="toast-info">
                        <div class="toast-nome">${nomeParziale}</div>
                        <div class="toast-prof">${inv.professione || 'Investitore'}</div>
                    </div>
                </div>
                <div class="toast-det">
                    <div>
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                        <span style="color:#999;">${cellOscurato}</span>
                    </div>
                    <div>
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span class="toast-budget">${budgetFormatted}</span>
                    </div>
                    <div style="font-size:12px;color:#4CAF50;font-weight:600;">
                        ✅ Disponibile per investire con esperto
                    </div>
                </div>
                <button class="toast-btn" onclick="chiamaInvestitore('${inv.email}')">📞 Chiamalo - Passa ad Esperto</button>
            `;
            
            setTimeout(() => toastEl.classList.add('show'), 100);
            currentToast = toastEl;
            
            // Auto-chiudi dopo 115 secondi (per far spazio al prossimo ogni 2 min)
            setTimeout(() => {
                if (currentToast) closeToast();
            }, 115000);
        }

        function closeToast() {
            const toastEl = document.getElementById('toastInv');
            toastEl.classList.remove('show');
            toastEl.classList.add('hide-anim');
            setTimeout(() => {
                toastEl.classList.remove('hide-anim');
                toastEl.innerHTML = '';
            }, 500);
            currentToast = null;
        }

        function oscuraCellulare(cell) {
            if (!cell) return '●●● ●●● ●●●●';
            const clean = cell.replace(/[^0-9]/g, '');
            if (clean.length < 4) return '●●● ●●● ●●●●';
            const ultimi4 = clean.slice(-4);
            return '●●● ●●● ●' + ultimi4.slice(-3);
        }

        function chiamaInvestitore(email) {
            alert(`🎉 Ottimo! Contatteremo ${email} per mettervi in contatto.\n\nPasserai all'Area Esperti e potrai accedere a questo investitore.`);
            closeToast();
        }

        function popFilt() {
            const regs = new Set();
            allData.forEach(i => { if (i.Regione) regs.add(i.Regione); });
            document.getElementById('fReg').innerHTML = '<option value="">Tutte le regioni</option>' +
                [...regs].sort().map(r => `<option value="${r}">${r}</option>`).join('');
            updCitta();
        }

        function updCitta() {
            const r = document.getElementById('fReg').value;
            const cits = new Set();
            allData.forEach(d => {
                if (r && d.Regione !== r) return;
                if (d.Comune) cits.add(d.Comune);
            });
            document.getElementById('fCit').innerHTML = '<option value="">Tutte le città</option>' +
                [...cits].sort().map(c => `<option value="${c}">${c}</option>`).join('');
        }

        // CAMBIA FILTRI in base al tipo selezionato (SCALABILE)
        function cambiaFiltri() {
            const tipo = document.getElementById('fTipoRicerca').value;
            currentType = tipo || 'Tutti';
            currentPage = 1; // RESET pagina
            console.log('📊 Tipo selezionato:', tipo);
            
            // Per investitori, nascondi i filtri standard
            if (tipo === 'Investitori') {
                document.getElementById('filtriAsteNPL').classList.add('hide');
            } else {
                document.getElementById('filtriAsteNPL').classList.remove('hide');
            }
            
            rend();
        }
        
        function appFilt() { currentPage = 1; rend(); }
        function clrFilt() {
            // Reset filtri Aste/NPL
            document.getElementById('fReg').value = '';
            document.getElementById('fCit').value = '';
            document.getElementById('fSearch').value = '';
            
            currentPage = 1;
            rend();
        }

        // ═══════════════════════════════════════════════════════
        // 📱 HINT SCROLL MOBILE/TABLET (solo su schermi piccoli)
        // ═══════════════════════════════════════════════════════
        function updateMobileScrollHint() {
            const hint = document.getElementById('mobileScrollHint');
            const tableWarning = document.getElementById('mobileTableWarning');
            
            // Rileva se è mobile (max 768px - solo smartphone)
            const isMobile = window.innerWidth <= 768;
            
            if (hint) {
                // Hint scroll appare su mobile E tablet (≤1024px)
                const isSmallScreen = window.innerWidth <= 1024;
                if (isSmallScreen) {
                    hint.style.display = 'inline';
                    hint.textContent = '(Scorri con il dito verso destra per vedere tutto →)';
                } else {
                    hint.style.display = 'none';
                }
            }
            
            // Avvertenza tabella SOLO su smartphone (≤768px)
            if (tableWarning) {
                tableWarning.style.display = isMobile ? 'block' : 'none';
            }
            
            // Avvertenze corsi SOLO su smartphone (≤768px)
            document.querySelectorAll('.mobile-warning').forEach(warning => {
                warning.style.display = isMobile ? 'block' : 'none';
            });
        }

        // Aggiorna hint anche al resize
        window.addEventListener('resize', updateMobileScrollHint);
        
        // Aggiorna al caricamento pagina
        window.addEventListener('DOMContentLoaded', updateMobileScrollHint);

        function getFilt() {
            let f = [...allData];
            
            // Filtra per tipo (Asta/NPL) usando currentType
            if (currentType === 'Asta' || currentType === 'NPL') {
                f = f.filter(d => {
                    const tipo = (d.TipoRecord || d.Tipo || '').toString().trim().toLowerCase();
                    return tipo === currentType.toLowerCase();
                });
            }
            
            const r = document.getElementById('fReg').value;
            if (r) f = f.filter(d => d.Regione === r);
            
            const c = document.getElementById('fCit').value;
            if (c) f = f.filter(d => d.Comune === c);
            
            const s = document.getElementById('fSearch').value.toLowerCase();
            if (s) f = f.filter(d => Object.values(d).some(v => String(v).toLowerCase().includes(s)));
            
            return f;
        }

        function prsDate(s) {
            if (!s) return new Date(9999, 11, 31);
            const p = String(s).split('/');
            if (p.length === 3) {
                const dt = new Date(p[2], p[1] - 1, p[0]);
                return isNaN(dt) ? new Date(9999, 11, 31) : dt;
            }
            return new Date(9999, 11, 31);
        }

        function prsPrz(v) {
            if (!v) return null;
            if (typeof v === 'number') return v;
            // Formato italiano: € 67.500,00
            const s = String(v).replace('€', '').replace(/\s/g, '').trim();
            const n = s.replace(/\./g, '').replace(',', '.');
            const f = parseFloat(n);
            return isNaN(f) ? null : f;
        }

        function rend() {
            // GESTIONE INVESTITORI
            if (currentType === 'Investitori') {
                rendInvestitori();
                return;
            }
            
            // GESTIONE ASTE/NPL (codice originale)
            let d = getFilt();
            
            // Ordina DECRESCENTE per data (PIÙ LONTANE PRIMA)
            d = [...d].sort((a, b) => {
                const dA = prsDate(a['Data Asta']);
                const dB = prsDate(b['Data Asta']);
                return dB - dA; // DECRESCENTE
            });

            // ═══════════════════════════════════════════════════════
            // 📄 PAGINAZIONE
            // ═══════════════════════════════════════════════════════
            const totalItems = d.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Assicura che currentPage sia valida
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
            
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = d.slice(start, end);

            const asteN = allData.filter(x => {
                const tipo = (x.TipoRecord || x.Tipo || '').toString().trim().toLowerCase();
                return tipo === 'asta';
            }).length;
            const nplN = allData.filter(x => {
                const tipo = (x.TipoRecord || x.Tipo || '').toString().trim().toLowerCase();
                return tipo === 'npl';
            }).length;
            
            // DEBUG LOG
            console.log(`📊 CONTEGGIO DASHBOARD:`);
            console.log(`  allData.length: ${allData.length}`);
            console.log(`  Aste (tipo==='asta'): ${asteN}`);
            console.log(`  NPL (tipo==='npl'): ${nplN}`);
            console.log(`  Sample primi 5 record:`);
            for(let i = 0; i < Math.min(5, allData.length); i++) {
                const x = allData[i];
                console.log(`    [${i}] ID=${x['Project ID']}, TipoRecord='${x.TipoRecord}', Tipo='${x.Tipo}'`);
            }
            
            document.getElementById('sAste').textContent = asteN;
            document.getElementById('sNPL').textContent = nplN;

            const tbody = document.getElementById('tblBody');
            const thead = document.getElementById('tblHead');
            
            if (totalItems === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:35px;">Nessun risultato</td></tr>';
                document.getElementById('blurWrap').classList.add('hide');
                mostraPaginazione(0, 0);
                return;
            }

            // Determina tipo di visualizzazione
            const isNPL = currentType === 'NPL';
            const isAsta = currentType === 'Asta';
            const isTutti = currentType === 'Tutti' || !currentType;
            
            // Aggiorna titolo e header
            if (isTutti) {
                // Mostra Aste e NPL insieme
                document.getElementById('tblTitle').innerHTML = '📊 Tutte le Opportunità';
                thead.innerHTML = '<tr><th>Tipo</th><th>Regione</th><th>Comune</th><th>Indirizzo</th><th>Prezzo/Debitoria</th><th>Data Asta</th><th>Azioni</th></tr>';
            } else if (isNPL) {
                document.getElementById('tblTitle').innerHTML = '📋 NPL Disponibili';
                thead.innerHTML = '<tr><th>Project ID</th><th>Numero Pratica</th><th>Indirizzo</th><th>Regione</th><th>Comune</th><th>Debitoria Totale</th><th>Azioni</th></tr>';
            } else {
                document.getElementById('tblTitle').innerHTML = '🔨 Aste Disponibili';
                thead.innerHTML = '<tr><th>Tipo</th><th>Regione</th><th>Comune</th><th>Indirizzo</th><th>Prezzo Base Asta</th><th>Data Asta</th><th>Azioni</th></tr>';
            }
            
            // Mostra hint scroll SOLO su mobile/tablet (max 1024px)
            updateMobileScrollHint();

            window.tblData = d;
            
            // ═══════════════════════════════════════════════════════
            // 🎯 LOGICA NPL: Primi 3 FREE, resto PREMIUM
            // ═══════════════════════════════════════════════════════
            let free, lock;
            
            if (isNPL) {
                if (usr && usr.role === 'admin') {
                    // 👑 ADMIN: mostra TUTTI gli NPL senza blur
                    free = pageData;
                    console.log(`👑 ADMIN: Mostra tutti ${pageData.length} NPL`);
                } else {
                    // 👤 FREE: primi 3 visibili, resto blurrato
                    // Tutti gli NPL sono mostrati, ma solo i primi 3 sono "free"
                    free = pageData;
                    console.log(`👤 FREE: Mostra tutti ${pageData.length} NPL (primi 3 visibili, resto blurrato)`);
                }
            } else {
                // ASTE: tutte libere
                free = pageData;
            }

            if (isNPL) {
                // TABELLA NPL: Primi 3 visibili, resto blurrato (solo per FREE)
                const isAdmin = usr && usr.role === 'admin';
                
                tbody.innerHTML = free.map((it, i) => {
                    // Determina se questo NPL deve essere blurrato
                    // ADMIN vede tutto chiaro
                    // FREE vede solo i primi 3 chiari, resto blurrato
                    const shouldBlur = !isAdmin && i >= 3;
                    
                    const projID = it['Project ID'] || '-';
                    const numPrat = shouldBlur ? '***' : (it['Numero Pratica'] || it['Numero Pratica _ NDG'] || '-');
                    const ind = shouldBlur ? '██████████████████' : (it['Indirizzo'] || '-');
                    const reg = it.Regione || '-';
                    const com = shouldBlur ? '███' : (it.Comune || '-');
                    
                    let deb = '-';
                    if (!shouldBlur) {
                        const debVal = it['Debitoria Totale'] || it['Debitoria totale'];
                        const debP = prsPrz(debVal);
                        if (debP) deb = '€' + Math.round(debP).toLocaleString('it-IT');
                    } else {
                        deb = '€███.███';
                    }
                    
                    // Badge Premium per NPL blurrati
                    const badgePremium = shouldBlur ? 
                        '<span style="background:linear-gradient(135deg,#FFD700,#FFA500);color:#000;padding:3px 8px;border-radius:12px;font-size:0.7em;font-weight:700;margin-left:5px;display:inline-flex;align-items:center;gap:3px;">💎 PREMIUM</span>' : 
                        '';
                    
                    // Bottone
                    const btnText = shouldBlur ? '🔒 Passa a Premium' : 'Dettagli';
                    const btnClick = shouldBlur ? 'shPremiumPopup()' : 'shDet(' + i + ')';
                    
                    // Stile blur per riga se blurrato
                    const rowStyle = shouldBlur ? 'style="filter:blur(2px);opacity:0.7;background:#f5f5f5;"' : '';

                    return `<tr ${rowStyle}>
                        <td>${projID}${badgePremium}</td>
                        <td>${numPrat}</td>
                        <td style="max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${ind}">${ind}</td>
                        <td>${reg}</td>
                        <td>${com}</td>
                        <td><strong style="color:#2196F3;">${deb}</strong></td>
                        <td><button class="btn-det" onclick="${btnClick}">${btnText}</button></td>
                    </tr>`;
                }).join('');
            } else {
                // TABELLA ASTE
                tbody.innerHTML = free.map((it, i) => {
                    const bdg = '<span class="badge badge-asta">🔨 ASTA</span>';
                    const reg = it.Regione || '-';
                    const com = it.Comune || '-';
                    const ind = it.Indirizzo || '-';
                    
                    let prz = '-';
                    const pV = it["Prezzo base d'asta"];
                    const pP = prsPrz(pV);
                    if (pP) prz = '€' + Math.round(pP).toLocaleString('it-IT');
                    
                    const dta = it['Data Asta'] || '-';

                    return `<tr>
                        <td>${bdg}</td>
                        <td>${reg}</td>
                        <td>${com}</td>
                        <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${ind}">${ind}</td>
                        <td><strong style="color:#4CAF50;">${prz}</strong></td>
                        <td>${dta}</td>
                        <td><button class="btn-det" onclick="shDet(${i})">Dettagli</button></td>
                    </tr>`;
                }).join('');
            }

            // NON mostrare più blur box (ora blur è inline per ogni NPL premium)

            document.getElementById('recordCount').textContent = totalItems;
            
            // MOSTRA PAGINAZIONE
            mostraPaginazione(totalPages, totalItems);
        }
        
        // RENDER INVESTITORI con dati oscurati (blur)
        function rendInvestitori() {
            console.log('🔍 rendInvestitori() chiamata');
            console.log('📊 Investitori array:', investitori);
            console.log('📊 Lunghezza:', investitori.length);
            
            const tbody = document.getElementById('tblBody');
            const thead = document.getElementById('tblHead');
            
            // Mostra TUTTI gli investitori (no filtri)
            let invFiltrati = [...investitori];
            
            console.log('✅ Investitori da mostrare:', invFiltrati.length);
            if (invFiltrati.length > 0) {
                console.log('🔍 Primo investitore:', invFiltrati[0]);
            }
            
            // Aggiorna UI
            document.getElementById('tblTitle').innerHTML = '💰 Investitori con Capitale';
            document.getElementById('blurWrap').classList.add('hide'); // nasconde blur NPL
            
            // Header tabella investitori
            thead.innerHTML = '<tr><th>Nome</th><th>Cognome</th><th>Budget</th><th>Professione</th><th>Email</th><th>Telefono</th><th>Azioni</th></tr>';
            
            // Mostra hint scroll SOLO su mobile/tablet
            updateMobileScrollHint();
            
            if (invFiltrati.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:35px;">Nessun investitore trovato</td></tr>';
                document.getElementById('recordCount').textContent = '0';
                return;
            }
            
            window.tblData = invFiltrati; // salva per dettagli
            
            // TUTTI GLI INVESTITORI VISIBILI (ma dati oscurati per FREE)
            tbody.innerHTML = invFiltrati.map((inv, i) => {
                console.log(`📝 Elaboro investitore ${i}:`, inv);
                
                // Nome: LIBERO
                const nome = inv.Nome || inv.nome || '-';
                
                // Cognome: OSCURATO con blur forte
                const cognomeCompleto = inv.Cognome || inv.cognome || 'XXXXX';
                
                // Budget: LIBERO e formattato (prova sia maiuscolo che minuscolo)
                const budgetNum = inv.Budget || inv.budget || 0;
                const budget = budgetNum > 0 ? '€' + budgetNum.toLocaleString('it-IT') : '€0';
                
                // Professione: LIBERA
                const prof = inv.Professione || inv.professione || 'Non specificata';
                
                // Email: OSCURATA con blur - mostro pattern realistico
                const emailCompleta = inv.Email || inv.email || 'email@esempio.it';
                const emailFake = emailCompleta.substring(0, 1) + '****@****.***';
                
                // Telefono: OSCURATO con blur - mostro pattern realistico  
                const telCompleto = inv.Cellulare || inv.cellulare || inv.Telefono || '+39 000 0000000';
                const telFake = '+39 ***';
                
                return `<tr>
                    <td><strong>${nome}</strong></td>
                    <td><span class="blur-data" title="🔒 Sblocca con Area Esperti" style="min-width:80px;display:inline-block;">${cognomeCompleto}</span></td>
                    <td><strong style="color:#4CAF50;font-size:1.05em;">${budget}</strong></td>
                    <td>${prof}</td>
                    <td><span class="blur-data" title="🔒 Sblocca con Area Esperti" style="min-width:120px;display:inline-block;">${emailFake}</span></td>
                    <td><span class="blur-data" title="🔒 Sblocca con Area Esperti" style="min-width:90px;display:inline-block;">${telFake}</span></td>
                    <td><button class="btn-det" onclick="shDetInvestitore(${i})">Dettagli</button></td>
                </tr>`;
            }).join('');
            
            document.getElementById('recordCount').textContent = invFiltrati.length;
            
            console.log('✅ Tabella investitori renderizzata');
        }
        
        // MOSTRA DETTAGLI INVESTITORE (popup upgrade Esperti POTENTE)
        function shDetInvestitore(idx) {
            console.log('🔥 shDetInvestitore chiamato per idx:', idx);
            const inv = window.tblData[idx];
            console.log('👤 Investitore:', inv);
            
            if (!inv) {
                console.error('❌ Investitore non trovato');
                return;
            }
            
            // Mostra popup upgrade Esperti
            const modal = document.getElementById('modal');
            const modalHead = modal.querySelector('.modal-head h2');
            const modalBody = document.getElementById('detCont');
            
            // Dati investitore
            const nomeInv = inv.Nome || inv.nome || 'Investitore';
            const cognomeInv = inv.Cognome || inv.cognome || 'X';
            const budgetInv = inv.Budget || inv.budget || 0;
            const profInv = inv.Professione || inv.professione || 'Professionista';
            
            // Calcola capitale totale
            const capitaleTotale = investitori.reduce((sum, i) => sum + (i.Budget || i.budget || 0), 0);
            const numInv = investitori.length;
            
            modalHead.innerHTML = '💎 Sblocca Contatto';
            
            // POPUP RESPONSIVE (mobile-friendly)
            modalBody.innerHTML = '<div style="text-align:center;padding:15px 10px;max-width:500px;margin:0 auto;">' +
                // Badge Area Esperti BLU (responsive)
                '<div style="display:inline-flex;margin-bottom:15px;">' +
                    '<div class="badge-area badge-esperti" style="min-width:140px;padding:10px 20px;box-shadow:0 6px 20px rgba(102,126,234,0.4);">' +
                        '<div class="badge-icon" style="font-size:2em;margin-bottom:6px;">💎</div>' +
                        '<div class="badge-title" style="font-size:1.1em;margin-bottom:3px;">Area Esperti</div>' +
                        '<div class="badge-subtitle" style="font-size:0.8em;">PRO</div>' +
                    '</div>' +
                '</div>' +
                
                // Titolo (responsive)
                '<h3 style="color:#667eea;margin-bottom:10px;font-size:clamp(1.1em, 4vw, 1.4em);">Contatto Bloccato</h3>' +
                
                // Box Investitore (responsive)
                '<div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:12px 15px;border-radius:8px;margin:15px auto;max-width:95%;box-shadow:0 4px 15px rgba(102,126,234,0.3);">' +
                    '<div style="color:#fff;font-size:clamp(1.1em, 4vw, 1.3em);font-weight:700;margin-bottom:4px;">' + nomeInv + ' ' + cognomeInv.charAt(0) + '.</div>' +
                    '<div style="color:#FFD700;font-size:clamp(1.4em, 5vw, 1.8em);font-weight:900;margin-bottom:4px;">€' + budgetInv.toLocaleString('it-IT') + '</div>' +
                    '<div style="color:rgba(255,255,255,0.9);font-size:clamp(0.9em, 3.5vw, 1em);">' + profInv + '</div>' +
                '</div>' +
                
                // BANNER GARANZIA (responsive)
                '<div style="background:linear-gradient(135deg,#4CAF50,#45a049);padding:10px 12px;margin:15px auto;max-width:95%;border-radius:6px;box-shadow:0 3px 12px rgba(76,175,80,0.3);border:2px solid #4CAF50;">' +
                    '<div style="display:flex;align-items:center;gap:8px;text-align:left;">' +
                        '<div style="font-size:clamp(1.8em, 6vw, 2.2em);line-height:1;flex-shrink:0;">✅</div>' +
                        '<div style="flex:1;">' +
                            '<p style="margin:0;color:#fff;font-weight:700;font-size:clamp(0.85em, 3.5vw, 0.95em);line-height:1.3;">100% GARANZIA REALE</p>' +
                            '<p style="margin:3px 0 0 0;color:rgba(255,255,255,0.95);font-size:clamp(0.75em, 3vw, 0.85em);line-height:1.3;">Tutti gli investitori sono <strong>reali</strong> e hanno <strong>richiesto</strong> di essere contattati</p>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                
                // Benefici (responsive)
                '<div style="background:rgba(102,126,234,0.08);border:2px solid #667eea;padding:12px 15px;margin:15px auto;max-width:95%;text-align:left;border-radius:6px;">' +
                    '<p style="margin:0 0 10px 0;font-weight:700;color:#667eea;font-size:clamp(0.95em, 3.5vw, 1.05em);text-align:center;">💎 Con Area Esperti PRO</p>' +
                    '<ul style="margin:0;padding-left:18px;color:#555;line-height:1.6;font-size:clamp(0.8em, 3vw, 0.9em);">' +
                        '<li><strong>Nome e Cognome</strong> completi</li>' +
                        '<li><strong>Email e Telefono</strong> diretti</li>' +
                        '<li><strong>€' + capitaleTotale.toLocaleString('it-IT') + '</strong> capitale disponibile</li>' +
                        '<li><strong>' + numInv + ' investitori</strong> verificati</li>' +
                        '<li>Accesso <strong>illimitato</strong></li>' +
                    '</ul>' +
                '</div>' +
                
                // CTA (responsive)
                '<button class="btn-prem" style="font-size:clamp(1em, 3.5vw, 1.15em);padding:12px 25px;margin-top:12px;background:linear-gradient(135deg,#667eea,#764ba2);border:2px solid #667eea;box-shadow:0 6px 18px rgba(102,126,234,0.4);font-weight:700;width:100%;max-width:320px;" onclick="window.open(\'https://francesco-gentile.it/candidatura-esperti\', \'_blank\')">🚀 PASSA AD AREA ESPERTI</button>' +
                
                // Footer piccolo
                '<p style="margin-top:10px;font-size:clamp(0.75em, 2.8vw, 0.85em);color:#999;">Accesso immediato dopo approvazione</p>' +
            '</div>';
            
            modal.classList.add('show');
                '<p style="margin-top:12px;font-size:0.85em;color:#999;">Accesso immediato dopo approvazione</p>' +
            '</div>';
            
            modal.classList.add('show');
            console.log('✅ Popup mostrato');
        }

        function shDet(idx) {
            const it = window.tblData[idx];
            const cont = document.getElementById('detCont');
            
            // Ordine campi per ASTE
            const ordineAste = [
                'Project ID',
                'Tipo',
                'Titolo',
                'Indirizzo',
                'Comune',
                'Provincia',
                'CAP',
                'Regione',
                'Destinazione d\'uso',
                'Prezzo base d\'asta',
                'Situazione debitoria',
                'Valutazione garanzie',
                'Tribunale',
                'RG',
                'Data Asta',
                'Lotto',
                'Numero Pratica _ NDG',
                'vuoi prenderlo in pre asta?Clicca e scrivici'
            ];
            
            // Ordine campi per NPL
            const ordineNPL = [
                'Project ID',
                'Tipo',
                'Numero Pratica _ NDG',
                'New',
                'Titolo',
                'Indirizzo',
                'CAP',
                'Comune',
                'Provincia',
                'Regione',
                'Destinazione d\'uso',
                'Debitoria totale',
                'Situazione debitoria',
                'Data saldo originale dei prestiti',
                'Numero immobili',
                'Area totale di tutte le proprietà (in mq)',
                'Valutazione garanzie secondo ultimi report',
                'Prezzo base d\'asta',
                'Telefonare per info'
            ];
            
            const ordine = it.Tipo === 'Asta' ? ordineAste : ordineNPL;
            const keys = [...ordine.filter(k => it.hasOwnProperty(k)), ...Object.keys(it).filter(k => !ordine.includes(k))];
            
            cont.innerHTML = keys.map(k => {
                let v = it[k];
                
                // Formatta i prezzi
                if ((k.includes('Prezzo') || k.includes('Debitoria') || k.includes('Valutazione') || k.includes('debitoria')) && v) {
                    const num = prsPrz(v);
                    if (num) v = '€' + Math.round(num).toLocaleString('it-IT');
                }
                
                // Formatta link
                if ((k.includes('vuoi prenderlo') || k.includes('Clicca')) && v && v.includes('http')) {
                    v = `<a href="${v}" target="_blank" style="color:#667eea;font-weight:600;">📧 Contattaci per Pre-Asta</a>`;
                }
                
                // Formatta telefono
                if (k.includes('Telefon') && v) {
                    v = `<a href="tel:${v}" style="color:#4CAF50;font-weight:600;">📞 ${v}</a>`;
                }
                
                if (!v || v === '' || v === 'null' || v === 'undefined') v = '-';
                
                return `<div class="det-item"><label>${k}</label><div class="val">${v}</div></div>`;
            }).join('');
            
            document.getElementById('modal').classList.add('show');
        }

        function clsMod() { document.getElementById('modal').classList.remove('show'); }
        function toggleAdmin() { document.getElementById('adminPan').classList.toggle('hide'); }
        async function toggleInvestitori() { 
            document.getElementById('investitoriPan').classList.toggle('hide'); 
            if (!document.getElementById('investitoriPan').classList.contains('hide')) {
                // RICARICA investitori da Firebase ogni volta che apri il pannello
                shLd('Caricamento investitori...');
                await ldInvestitori();
                renderInvestitori();
                hdLd();
            }
        }

        function renderInvestitori() {
            const tbody = document.getElementById('invTableBody');
            document.getElementById('capitaleTot').textContent = capitaleDisponibile.toLocaleString('it-IT');
            
            if (investitori.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:20px;">Nessun investitore</td></tr>';
                return;
            }
            
            tbody.innerHTML = investitori.map((inv, idx) => `
                <tr>
                    <td style="padding:10px;">${inv.nome}</td>
                    <td style="padding:10px;">${inv.cognome}</td>
                    <td style="padding:10px;">${inv.email}</td>
                    <td style="padding:10px;">${inv.cellulare}</td>
                    <td style="padding:10px;"><strong style="color:#4CAF50;">€${(inv.budget || 0).toLocaleString('it-IT')}</strong></td>
                    <td style="padding:10px;">${inv.professione}</td>
                    <td style="padding:10px;"><button onclick="rimuoviInvestitore(${idx})" class="top-btn btn-red" style="padding:5px 10px;font-size:11px;">🗑️</button></td>
                </tr>
            `).join('');
        }

        async function caricaDatiEsempio() {
            if (!confirm('⚠️ Caricare 15 investitori esempio su Firebase?\n\nQuesta operazione AGGIUNGERÀ i dati a quelli esistenti.')) return;
            
            shLd('Caricamento dati esempio...');
            try {
                console.log('🚀 Inizio caricamento dati esempio...');
                console.log('📊 Investitori attuali:', investitori.length);
                
                const datiEsempio = [
                    {nome: "Marco", cognome: "Rossi", email: "marco.rossi@email.it", cellulare: "+39 333 1234567", budget: 250000, professione: "Imprenditore"},
                    {nome: "Giulia", cognome: "Bianchi", email: "giulia.bianchi@email.it", cellulare: "+39 340 7654321", budget: 180000, professione: "Manager"},
                    {nome: "Luca", cognome: "Verdi", email: "luca.verdi@email.it", cellulare: "+39 347 9876543", budget: 320000, professione: "Investitore"},
                    {nome: "Francesca", cognome: "Neri", email: "francesca.neri@email.it", cellulare: "+39 338 5551234", budget: 150000, professione: "Consulente"},
                    {nome: "Alessandro", cognome: "Gialli", email: "alessandro.gialli@email.it", cellulare: "+39 349 8887766", budget: 420000, professione: "Imprenditore"},
                    {nome: "Sofia", cognome: "Blu", email: "sofia.blu@email.it", cellulare: "+39 345 3334455", budget: 280000, professione: "Libero Professionista"},
                    {nome: "Matteo", cognome: "Viola", email: "matteo.viola@email.it", cellulare: "+39 335 6667788", budget: 190000, professione: "Commercialista"},
                    {nome: "Elena", cognome: "Arancio", email: "elena.arancio@email.it", cellulare: "+39 339 9998877", budget: 350000, professione: "Avvocato"},
                    {nome: "Davide", cognome: "Rosa", email: "davide.rosa@email.it", cellulare: "+39 348 1112233", budget: 210000, professione: "Architetto"},
                    {nome: "Chiara", cognome: "Marrone", email: "chiara.marrone@email.it", cellulare: "+39 346 4445566", budget: 280000, professione: "Medico"},
                    {nome: "Roberto", cognome: "Grigio", email: "roberto.grigio@email.it", cellulare: "+39 333 7778899", budget: 380000, professione: "Notaio"},
                    {nome: "Valeria", cognome: "Celeste", email: "valeria.celeste@email.it", cellulare: "+39 340 1112222", budget: 220000, professione: "Farmacista"},
                    {nome: "Simone", cognome: "Argento", email: "simone.argento@email.it", cellulare: "+39 347 3334444", budget: 290000, professione: "Ingegnere"},
                    {nome: "Martina", cognome: "Oro", email: "martina.oro@email.it", cellulare: "+39 338 5556666", budget: 410000, professione: "Dirigente"},
                    {nome: "Giovanni", cognome: "Bronzo", email: "giovanni.bronzo@email.it", cellulare: "+39 349 7778888", budget: 330000, professione: "Commerciante"}
                ];
                
                console.log('➕ Aggiunta 15 investitori ai', investitori.length, 'esistenti');
                
                // AGGIUNGI ai esistenti (non sostituire)
                investitori = [...investitori, ...datiEsempio];
                
                console.log('💾 Salvataggio su Firebase...', investitori.length, 'investitori totali');
                await db.ref('investitori').set(investitori);
                console.log('✅ Salvato su Firebase!');
                
                // RICALCOLA CAPITALE
                capitaleDisponibile = investitori.reduce((sum, inv) => sum + (inv.budget || 0), 0);
                console.log('💰 Nuovo capitale:', capitaleDisponibile);
                
                // AGGIORNA TUTTO
                aggiornaCounterCapitale();
                renderInvestitori();
                
                // AVVIA TOAST se non già avviato
                if (!toastInterval) {
                    console.log('🎯 Avvio toast investitori...');
                    startToastInvestitori();
                }
                
                document.getElementById('invAlert').innerHTML = '<div style="background:#d4edda;color:#155724;padding:11px;border-radius:7px;margin-bottom:13px;">✅ Caricati 15 investitori! Capitale totale: €' + capitaleDisponibile.toLocaleString('it-IT') + '</div>';
                setTimeout(() => document.getElementById('invAlert').innerHTML = '', 3500);
            } catch (e) {
                console.error('❌ ERRORE:', e);
                alert('❌ Errore: ' + e.message);
            } finally {
                hdLd();
            }
        }

        async function aggiungiInvestitore() {
            const nome = document.getElementById('invNome').value.trim();
            const cognome = document.getElementById('invCognome').value.trim();
            const email = document.getElementById('invEmail').value.trim();
            const cellulare = document.getElementById('invCell').value.trim();
            const budget = parseInt(document.getElementById('invBudget').value) || 0;
            const professione = document.getElementById('invProf').value.trim();
            
            if (!nome || !cognome || !email || !budget) {
                alert('❌ Compila almeno Nome, Cognome, Email e Budget!');
                return;
            }
            
            shLd('Aggiunta investitore...');
            try {
                const nuovoInv = {nome, cognome, email, cellulare, budget, professione};
                investitori.push(nuovoInv);
                
                // SALVA SU FIREBASE
                await db.ref('investitori').set(investitori);
                
                // RICALCOLA CAPITALE
                capitaleDisponibile = investitori.reduce((sum, inv) => sum + (inv.budget || 0), 0);
                
                // AGGIORNA COUNTER VISIVO
                aggiornaCounterCapitale();
                
                // PULISCI FORM
                document.getElementById('invNome').value = '';
                document.getElementById('invCognome').value = '';
                document.getElementById('invEmail').value = '';
                document.getElementById('invCell').value = '';
                document.getElementById('invBudget').value = '';
                document.getElementById('invProf').value = '';
                
                renderInvestitori();
                document.getElementById('invAlert').innerHTML = '<div style="background:#d4edda;color:#155724;padding:11px;border-radius:7px;margin-bottom:13px;">✅ Investitore aggiunto!</div>';
                setTimeout(() => document.getElementById('invAlert').innerHTML = '', 2500);
            } catch (e) {
                alert('❌ Errore: ' + e.message);
            } finally {
                hdLd();
            }
        }

        async function rimuoviInvestitore(idx) {
            if (!confirm('⚠️ Rimuovere questo investitore?')) return;
            
            shLd('Rimozione...');
            try {
                investitori.splice(idx, 1);
                await db.ref('investitori').set(investitori);
                
                // RICALCOLA CAPITALE
                capitaleDisponibile = investitori.reduce((sum, inv) => sum + (inv.budget || 0), 0);
                
                // AGGIORNA COUNTER VISIVO
                aggiornaCounterCapitale();
                
                renderInvestitori();
            } catch (e) {
                alert('❌ Errore: ' + e.message);
            } finally {
                hdLd();
            }
        }

        async function upFile(e) {
            const f = e.target.files[0];
            if (!f) return;
            
            shLd('Lettura Excel...');
            try {
                const d = await rdXl(f);
                const fn = f.name.toUpperCase();
                
                // RICONOSCIMENTO AUTOMATICO TIPO FILE
                let tipoFile = null;
                
                // 1. Controlla se è INVESTITORI (dalle colonne)
                if (d.length > 0) {
                    const colonne = Object.keys(d[0]).map(k => k.toLowerCase());
                    const hasNome = colonne.some(c => c.includes('nome'));
                    const hasBudget = colonne.some(c => c.includes('budget'));
                    const hasEmail = colonne.some(c => c.includes('email'));
                    
                    if (hasNome && hasBudget && hasEmail) {
                        tipoFile = 'INVESTITORI';
                    }
                }
                
                // 2. Se non è investitori, controlla ASTE o NPL dal nome file
                if (!tipoFile) {
                    if (fn.includes('ASTE') || fn.includes('ASTA')) {
                        tipoFile = 'ASTE';
                    } else if (fn.includes('NPL')) {
                        tipoFile = 'NPL';
                    } else {
                        // Default: prova a capire dalle colonne
                        const colonne = Object.keys(d[0]).map(k => k.toLowerCase());
                        if (colonne.some(c => c.includes('project') || c.includes('pratica') || c.includes('debitoria'))) {
                            tipoFile = 'NPL';
                        } else {
                            tipoFile = 'ASTE';
                        }
                    }
                }
                
                console.log('🔍 Tipo file riconosciuto:', tipoFile);
                
                // GESTIONE IN BASE AL TIPO
                if (tipoFile === 'INVESTITORI') {
                    // CARICA INVESTITORI
                    shLd('Caricamento investitori...');
                    
                    const nuoviInv = d.map(row => ({
                        nome: row.Nome || row.nome || '',
                        cognome: row.Cognome || row.cognome || '',
                        email: row.Email || row.email || '',
                        cellulare: row.Cellulare || row.cellulare || row.Telefono || '',
                        budget: parseInt(row.Budget || row.budget || 0),
                        professione: row.Professione || row.professione || ''
                    })).filter(inv => inv.nome && inv.cognome && inv.budget > 0);
                    
                    if (nuoviInv.length === 0) {
                        throw new Error('Nessun investitore valido trovato');
                    }
                    
                    // AGGIUNGI ai esistenti
                    investitori = [...investitori, ...nuoviInv];
                    await db.ref('investitori').set(investitori);
                    
                    // RICALCOLA CAPITALE
                    capitaleDisponibile = investitori.reduce((sum, inv) => sum + (inv.budget || 0), 0);
                    aggiornaCounterCapitale();
                    
                    // AVVIA TOAST se non già avviato
                    if (!toastInterval) {
                        startToastInvestitori();
                    }
                    
                    document.getElementById('upAlert').innerHTML = `<div style="background:#d4edda;color:#155724;padding:11px;border-radius:7px;margin-bottom:13px;">✅ Caricati ${nuoviInv.length} INVESTITORI! Capitale: €${capitaleDisponibile.toLocaleString('it-IT')}</div>`;
                    
                } else {
                    // CARICA ASTE o NPL CON ANTI-DUPLICATI
                    const tp = tipoFile === 'ASTE' ? 'Asta' : 'NPL';
                    
                    // ═══════════════════════════════════════════════════════
                    // 🔍 SISTEMA ANTI-DUPLICATI
                    // ═══════════════════════════════════════════════════════
                    shLd('Controllo duplicati...');
                    
                    // Carica dati esistenti
                    const existingData = allData.filter(item => item.Tipo === tp);
                    console.log(`📊 ${tipoFile} esistenti:`, existingData.length);
                    
                    // Crea set di chiavi univoche esistenti
                    const existingKeys = new Set();
                    existingData.forEach(item => {
                        const key = `${item['Project ID']||''}_${item['Numero Pratica']||''}`.trim('_');
                        if (key && key !== '_') {
                            existingKeys.add(key);
                        }
                    });
                    
                    console.log(`🔑 Chiavi univoche esistenti:`, existingKeys.size);
                    
                    // Filtra nuovi dati eliminando duplicati
                    let nuoviDati = [];
                    let duplicatiTrovati = 0;
                    
                    d.forEach(row => {
                        const key = `${row['Project ID']||''}_${row['Numero Pratica']||''}`.trim('_');
                        
                        if (!key || key === '_') {
                            // Nessuna chiave valida - aggiungi comunque
                            row.Tipo = tp;
                            nuoviDati.push(row);
                        } else if (existingKeys.has(key)) {
                            // Duplicato trovato!
                            duplicatiTrovati++;
                            console.log(`⚠️ Duplicato:`, key);
                        } else {
                            // Nuovo record!
                            row.Tipo = tp;
                            nuoviDati.push(row);
                            existingKeys.add(key); // Aggiungi al set per evitare duplicati interni
                        }
                    });
                    
                    console.log(`✅ Nuovi ${tipoFile}:`, nuoviDati.length);
                    console.log(`⚠️ Duplicati saltati:`, duplicatiTrovati);
                    
                    if (nuoviDati.length === 0) {
                        document.getElementById('upAlert').innerHTML = `<div style="background:#fff3cd;color:#856404;padding:11px;border-radius:7px;margin-bottom:13px;">⚠️ Nessun nuovo ${tipoFile} da caricare. Tutti i ${d.length} record sono duplicati già presenti!</div>`;
                        setTimeout(() => document.getElementById('upAlert').innerHTML = '', 5000);
                        return;
                    }
                    
                    shLd(`Salvataggio ${nuoviDati.length} nuovi ${tipoFile}...`);
                    
                    // Salva solo i nuovi
                    await saveFB(nuoviDati);
                    
                    let messaggio = `✅ Caricati ${nuoviDati.length} nuovi ${tipoFile}!`;
                    if (duplicatiTrovati > 0) {
                        messaggio += ` (${duplicatiTrovati} duplicati saltati)`;
                    }
                    
                    document.getElementById('upAlert').innerHTML = `<div style="background:#d4edda;color:#155724;padding:11px;border-radius:7px;margin-bottom:13px;">${messaggio}</div>`;
                }
                
                setTimeout(() => document.getElementById('upAlert').innerHTML = '', 3500);
                
                // CHIUDI PANNELLO ADMIN dopo caricamento
                setTimeout(() => {
                    document.getElementById('adminPan').classList.add('hide');
                }, 3500);
                
            } catch (err) {
                console.error('❌ Errore upload:', err);
                document.getElementById('upAlert').innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:11px;border-radius:7px;margin-bottom:13px;">❌ ' + err.message + '</div>';
            } finally {
                hdLd();
                e.target.value = '';
            }
        }

        async function upFileInv(e) {
            const f = e.target.files[0];
            if (!f) return;
            shLd('Lettura Excel Investitori...');
            try {
                const d = await rdXl(f);
                
                // Mappa colonne Excel -> struttura investitore
                const nuoviInv = d.map(row => ({
                    nome: row.Nome || row.nome || '',
                    cognome: row.Cognome || row.cognome || '',
                    email: row.Email || row.email || '',
                    cellulare: row.Cellulare || row.cellulare || row.Telefono || '',
                    budget: parseInt(row.Budget || row.budget || 0),
                    professione: row.Professione || row.professione || ''
                })).filter(inv => inv.nome && inv.cognome && inv.budget > 0);
                
                if (nuoviInv.length === 0) {
                    throw new Error('Nessun investitore valido trovato. Verifica colonne: Nome, Cognome, Budget');
                }
                
                shLd('Salvataggio investitori...');
                
                // AGGIUNGI ai esistenti
                investitori = [...investitori, ...nuoviInv];
                await db.ref('investitori').set(investitori);
                
                // RICALCOLA CAPITALE
                capitaleDisponibile = investitori.reduce((sum, inv) => sum + (inv.budget || 0), 0);
                
                // AGGIORNA COUNTER VISIVO
                aggiornaCounterCapitale();
                
                // RIAVVIA TOAST se necessario
                if (toastInterval) {
                    clearInterval(toastInterval);
                    startToastInvestitori();
                }
                
                renderInvestitori();
                document.getElementById('invAlert').innerHTML = '<div style="background:#d4edda;color:#155724;padding:11px;border-radius:7px;margin-bottom:13px;">✅ Caricati ' + nuoviInv.length + ' investitori!</div>';
                setTimeout(() => document.getElementById('invAlert').innerHTML = '', 2500);
            } catch (err) {
                document.getElementById('invAlert').innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:11px;border-radius:7px;margin-bottom:13px;">❌ ' + err.message + '</div>';
            } finally {
                hdLd();
                e.target.value = '';
            }
        }

        function rdXl(f) {
            return new Promise((ok, err) => {
                const rdr = new FileReader();
                rdr.onload = (e) => {
                    try {
                        const dt = new Uint8Array(e.target.result);
                        const wb = XLSX.read(dt, {type: 'array'});
                        const sh = wb.Sheets[wb.SheetNames[0]];
                        const js = XLSX.utils.sheet_to_json(sh, {defval: ''});
                        ok(js);
                    } catch (er) {
                        err(new Error('File non valido'));
                    }
                };
                rdr.onerror = () => err(new Error('Errore lettura'));
                rdr.readAsArrayBuffer(f);
            });
        }

        async function saveFB(newD) {
            try {
                shLd('Salvataggio...');
                
                // Leggi dati esistenti
                const snap = await db.ref('data').once('value');
                const ex = snap.val();
                
                // Converti in array
                let all = [];
                if (ex) {
                    all = Array.isArray(ex) ? ex.filter(x => x) : Object.values(ex).filter(x => x);
                }
                
                console.log(`📊 Dati esistenti: ${all.length}`);
                console.log(`📊 Nuovi dati: ${newD.length}`);
                
                // AGGIUNGI nuovi dati (NON sostituire!)
                all = all.concat(newD);
                
                console.log(`📊 Totale prima dedup: ${all.length}`);
                
                // Rimuovi duplicati per Project ID
                const seen = new Set();
                all = all.filter(item => {
                    const id = item['Project ID'] || item['project_id'] || item.id;
                    if (id && seen.has(id)) {
                        console.log(`⚠️ Duplicato rimosso: ${id}`);
                        return false;
                    }
                    if (id) seen.add(id);
                    return true;
                });
                
                console.log(`📊 Totale dopo dedup: ${all.length}`);
                
                // Salva su Firebase
                const upd = {};
                all.forEach((it, i) => { upd[i] = it; });
                await db.ref('data').set(upd);
                
                // Aggiorna variabile locale
                allData = all;
                
                // Reset pagina
                currentPage = 1;
                
                console.log(`✅ UPLOAD COMPLETATO: ${all.length} record totali`);
                alert(`✅ File caricato!\n\nTotale record: ${all.length}\nNuovi aggiunti: ${newD.length}`);
                
                popFilt();
                rend();
                hdLd();
            } catch(err) {
                console.error('❌ Errore saveFB:', err);
                alert('❌ Errore durante il salvataggio: ' + err.message);
                hdLd();
                throw err;
            }
        }

        async function delDB() {
            if (!confirm('⚠️ Cancellare TUTTI i dati (Aste, NPL e Investitori)?')) return;
            shLd('Cancellazione...');
            try {
                // CANCELLA ASTE E NPL
                await db.ref('data').remove();
                allData = [];
                
                // CANCELLA INVESTITORI
                await db.ref('investitori').remove();
                investitori = [];
                capitaleDisponibile = 0;
                
                // AGGIORNA UI
                document.getElementById('sAste').textContent = '0';
                document.getElementById('sNPL').textContent = '0';
                aggiornaCounterCapitale();
                
                document.getElementById('tblBody').innerHTML = '<tr><td colspan="7" style="text-align:center;padding:35px;">Database vuoto - Carica dati</td></tr>';
                document.getElementById('blurWrap').classList.add('hide');
                document.getElementById('fReg').innerHTML = '<option value="">Tutte le regioni</option>';
                document.getElementById('fCit').innerHTML = '<option value="">Tutte le città</option>';
                
                hdLd();
                alert('✅ Database completamente svuotato!\n\nAste: 0\nNPL: 0\nInvestitori: 0\nCapitale: €0');
            } catch (e) {
                hdLd();
                alert('❌ Errore: ' + e.message);
            }
        }

        document.getElementById('modal').addEventListener('click', e => { if (e.target.id === 'modal') clsMod(); });
        document.getElementById('pass').addEventListener('keypress', e => { if (e.key === 'Enter') doLogin(); });
        
        // ═══════════════════════════════════════════════════════
        // 📄 FUNZIONI PAGINAZIONE
        // ═══════════════════════════════════════════════════════
        
        function mostraPaginazione(totalPages, totalItems) {
            let pagDiv = document.getElementById('pagination');
            if (!pagDiv) {
                // Crea div paginazione se non esiste
                const container = document.querySelector('.tab-content.active .table-wrap');
                if (!container) return;
                
                pagDiv = document.createElement('div');
                pagDiv.id = 'pagination';
                pagDiv.style.cssText = 'margin-top:25px;text-align:center;padding:20px;background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);';
                container.appendChild(pagDiv);
            }
            
            if (totalPages <= 1) {
                pagDiv.innerHTML = '';
                pagDiv.style.display = 'none';
                return;
            }
            
            pagDiv.style.display = 'block';
            
            let html = '<div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;">';
            html += `<span style="margin-right:15px;color:#666;font-weight:500;">Pagina ${currentPage} di ${totalPages} <span style="color:#999;">(${totalItems} risultati)</span></span>`;
            
            // Bottone Prima Pagina
            if (currentPage > 1) {
                html += '<button onclick="cambiaPage(1)" style="padding:10px 14px;border:2px solid #ddd;border-radius:8px;cursor:pointer;background:white;font-weight:600;transition:all 0.3s;" onmouseover="this.style.background=\'#f5f5f5\'" onmouseout="this.style.background=\'white\'">« Prima</button>';
                html += '<button onclick="cambiaPage(' + (currentPage-1) + ')" style="padding:10px 14px;border:2px solid #ddd;border-radius:8px;cursor:pointer;background:white;font-weight:600;transition:all 0.3s;" onmouseover="this.style.background=\'#f5f5f5\'" onmouseout="this.style.background=\'white\'">‹ Prec</button>';
            }
            
            // Numeri pagina (mostra max 5 pagine)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage;
                const bgColor = active ? '#667eea' : 'white';
                const textColor = active ? 'white' : '#333';
                const borderColor = active ? '#667eea' : '#ddd';
                const hoverBg = active ? '#667eea' : '#f0f0f0';
                
                html += `<button onclick="cambiaPage(${i})" style="padding:10px 14px;border:2px solid ${borderColor};border-radius:8px;cursor:pointer;background:${bgColor};color:${textColor};font-weight:${active ? '700' : '600'};min-width:45px;transition:all 0.3s;" onmouseover="this.style.background='${hoverBg}'" onmouseout="this.style.background='${bgColor}'">${i}</button>`;
            }
            
            // Bottone Ultima Pagina
            if (currentPage < totalPages) {
                html += '<button onclick="cambiaPage(' + (currentPage+1) + ')" style="padding:10px 14px;border:2px solid #ddd;border-radius:8px;cursor:pointer;background:white;font-weight:600;transition:all 0.3s;" onmouseover="this.style.background=\'#f5f5f5\'" onmouseout="this.style.background=\'white\'">Succ ›</button>';
                html += '<button onclick="cambiaPage(' + totalPages + ')" style="padding:10px 14px;border:2px solid #ddd;border-radius:8px;cursor:pointer;background:white;font-weight:600;transition:all 0.3s;" onmouseover="this.style.background=\'#f5f5f5\'" onmouseout="this.style.background=\'white\'">Ultima »</button>';
            }
            
            html += '</div>';
            pagDiv.innerHTML = html;
        }
        
        function cambiaPage(page) {
            currentPage = page;
            rend();
            // Scroll su
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>

